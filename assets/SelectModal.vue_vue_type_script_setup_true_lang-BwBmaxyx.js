import{d as A,a as B,c as M,q as P,w as _,g as d,u as b}from"./firebaseConfig-BR434puB.js";import{d as U,f as E,r as u,l as T,g as q,h as G,a as p,o as H,i as L,w as f,b as D,e as j,p as F,u as J}from"./index-BjAr1v-m.js";import{i as K}from"./setFirebaseData-DDiyQXTP.js";const O="/Mystery-of-Antiques-bg",Y=U({__name:"SelectModal",props:{showModal:{},showModalModifiers:{},playerData:{},playerDataModifiers:{},name:{},nameModifiers:{}},emits:["update:showModal","update:playerData","update:name"],setup(v){const I=E(),c=F(),N=J(),y=u(),t=u(""),h=u(!1),w=u();w.value=c.params.roomId;const i=A(B,"rooms",w.value),k=u("");k.value=String(c.query.player);const C=T(()=>c.query.host==="1"),m=q(v,"showModal"),R=q(v,"playerData"),V=q(v,"name"),g=T(()=>!(C.value&&c.fullPath.includes("room"))),$=async()=>{try{const o=M(i,"players"),e=await d(o),a=[];e.forEach(n=>{const s=n.data();if(s.remain){const l={label:s.name,value:s.character};a.push(l)}}),y.value=a,console.log(y.value)}catch{}},x=async o=>{const e=M(i,"players");let a=P(e,_("character","==",o)),s=(await d(a)).docs.map(l=>b(l.ref,{remain:0}));await Promise.all(s)},S=async o=>{const e=M(i,"players");let a=P(e,_("character","==",o)),n=await d(a);const s=n.docs.map(l=>b(l.ref,{myTurn:1}));if(await Promise.all(s),g.value){a=P(e,_("name","==",k.value)),n=await d(a);const l=n.docs.map(r=>b(r.ref,{myTurn:0}));await Promise.all(l)}},z=async()=>{t.value===null||t.value.trim()===""?I.warning("請選擇玩家"):g.value?(h.value=!0,await x(t.value),await S(t.value),R.value.attacked>0&&K(i,"players","name",R.value.name,"attacked",-1),m.value=!1,h.value=!1):(await x(t.value),await S(t.value),N.push({path:`${O}/game/${w.value}`,query:{host:C.value?1:0,player:String(V.value)}}))};return G(()=>m.value,o=>{o===!0&&($(),t.value=null)}),(o,e)=>{const a=p("n-select"),n=p("n-button"),s=p("n-card"),l=p("n-modal");return H(),L(l,{show:m.value,"onUpdate:show":e[2]||(e[2]=r=>m.value=r),"mask-closable":!!g.value},{default:f(()=>[D(s,{style:{width:"400px"},title:"選擇下一位玩家",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:f(()=>[D(n,{loading:h.value,size:"large",type:"primary",onClick:e[1]||(e[1]=r=>z())},{default:f(()=>[j("確認")]),_:1},8,["loading"])]),default:f(()=>[D(a,{value:t.value,"onUpdate:value":e[0]||(e[0]=r=>t.value=r),options:y.value},null,8,["value","options"])]),_:1})]),_:1},8,["show","mask-closable"])}}});export{Y as _};
