import{d as ae,o as p,c as W,g as A,k as se,r as o,l as G,m as ve,a as m,n as R,w as u,b as v,e as $,p as O,q as ce,F as ie,t as X,j as ue,u as re,h as me,s as ye,f as fe}from"./index-R7l2Jenq.js";import{d as ee,a as H,c as N,g as L,q as Q,w as le,u as ne,b as he,s as we,i as ge}from"./firebaseConfig-BxjB4Upe.js";import{s as oe,i as de,_ as _e}from"./SelectModal.vue_vue_type_script_setup_true_lang-z8IUAKHV.js";const ke={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},be=A("path",{d:"M384 224v184a40 40 0 0 1-40 40H104a40 40 0 0 1-40-40V168a40 40 0 0 1 40-40h167.48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),Me=A("path",{d:"M459.94 53.25a16.06 16.06 0 0 0-23.22-.56L424.35 65a8 8 0 0 0 0 11.31l11.34 11.32a8 8 0 0 0 11.34 0l12.06-12c6.1-6.09 6.67-16.01.85-22.38z",fill:"currentColor"},null,-1),Re=A("path",{d:"M399.34 90L218.82 270.2a9 9 0 0 0-2.31 3.93L208.16 299a3.91 3.91 0 0 0 4.86 4.86l24.85-8.35a9 9 0 0 0 3.93-2.31L422 112.66a9 9 0 0 0 0-12.66l-9.95-10a9 9 0 0 0-12.71 0z",fill:"currentColor"},null,-1),Ce=[be,Me,Re],xe=ae({name:"CreateOutline",render:function(P,b){return p(),W("svg",ke,Ce)}}),De={class:"flex justify-end mt-8"},$e=ae({__name:"CheckAntiquesModal",props:{showModal:{},showModalModifiers:{},currentRound:{},currentRoundModifiers:{},playerData:{},playerDataModifiers:{}},emits:["update:showModal","update:currentRound","update:playerData"],setup(U){const P=ue();re();const b=se(),C=o();C.value=P.params.roomId;const I=ee(H,"rooms",C.value),x=G(U,"showModal"),y=G(U,"currentRound"),r=G(U,"playerData"),f=o(),l=o(null),M=o(""),_=o(!0),i=["JiYunfu","MedicineIsNot","ZhengGuoqu","LaoChaofeng"],T=async()=>{try{console.log(y.value);const a=N(I,`ReadomAnimalForRound${y.value}`),n=await L(a),d=[];n.forEach(s=>{const w=s.data(),z={name:w.name,value:w.value,view_value:w.view_value};d.push(z)}),console.log(d),f.value=d}catch{}},Z=async()=>{let a=null;if(l.value.length===0||l.value===null)b.warning("請選擇至少一隻動物");else if(r.value.isCheckAble>y.value)b.warning("本輪已查看過，請勿作弊");else if(r.value.attacked>0)b.warning("你被藥不然偷襲了!!!",{closable:!0,duration:0}),_.value=!1,oe(I,"players","name",r.value.name,"isCheckAble",y.value+1);else{const n=typeof l.value=="string"?[l.value]:l.value;a=f.value.filter(s=>n.some(w=>w===s.name));let d=[];i.includes(r.value.character)?a.forEach(s=>{d.push(`${s.name}是${s.value>=0?s.value?"真的":"假的":"什麼鬼"}`)}):a.forEach(s=>{d.push(`${s.name}是${s.view_value>=0&&r.value.inActiveRound!==y.value?s.view_value?"真的":"假的":"什麼鬼"}`)}),M.value=d.join(`
`),console.log(M.value),_.value=!1,oe(I,"players","name",r.value.name,"isCheckAble",y.value+1)}},B=a=>{l.value=a};return ve(()=>x.value,a=>{a===!0&&(M.value="",T(),r.value.isCheckAble<=y.value?_.value=!0:_.value=!1)}),(a,n)=>{const d=m("n-radio"),s=m("n-space"),w=m("n-radio-group"),z=m("n-checkbox"),V=m("n-gi"),J=m("n-grid"),g=m("n-checkbox-group"),e=m("n-button"),k=m("n-card"),E=m("n-modal");return p(),R(E,{show:x.value,"onUpdate:show":n[3]||(n[3]=t=>x.value=t),"mask-closable":!0},{default:u(()=>[v(k,{style:{width:"400px"},title:"鑑定古董",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:u(()=>[A("div",De,[A("div",null,[v(e,{size:"large",onClick:n[1]||(n[1]=t=>x.value=!1)},{default:u(()=>[$("返回")]),_:1})]),A("div",null,[_.value?(p(),R(e,{key:0,size:"large",type:"primary",onClick:n[2]||(n[2]=t=>Z())},{default:u(()=>[$("確認")]),_:1})):O("",!0)])])]),default:u(()=>[r.value.character!=="MakeAWish"?(p(),R(w,{key:0,value:l.value,"onUpdate:value":n[0]||(n[0]=t=>l.value=t),name:"radiogroup"},{default:u(()=>[v(s,null,{default:u(()=>[(p(!0),W(ie,null,ce(f.value,t=>(p(),R(d,{key:t.name,value:t.name,label:t.name},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])):(p(),R(g,{key:1,max:2,"onUpdate:value":B},{default:u(()=>[v(J,{"y-gap":8,cols:2},{default:u(()=>[(p(!0),W(ie,null,ce(f.value,(t,h)=>(p(),R(V,{key:h},{default:u(()=>[v(z,{value:t.name,label:t.name},null,8,["value","label"])]),_:2},1024))),128))]),_:1})]),_:1})),M.value.length!==0?(p(),R(k,{key:2,title:"鑑定結果"},{default:u(()=>[$(X(M.value),1)]),_:1})):O("",!0)]),_:1})]),_:1},8,["show"])}}}),Ae={key:0},Se={key:1},qe={class:"flex justify-end mt-8"},Ue=ae({__name:"SkillModal",props:{showModal:{},showModalModifiers:{},currentRound:{},currentRoundModifiers:{},playerData:{},playerDataModifiers:{}},emits:["update:showModal","update:currentRound","update:playerData"],setup(U){const P=se(),b=ue();re();const C=o(),I=o(),x=o();x.value=b.params.roomId;const y=ee(H,"rooms",x.value),r=G(U,"showModal"),f=G(U,"currentRound"),l=G(U,"playerData"),M=o(),_=o(!1),i=o(""),T=o(""),Z=o(""),B=o(""),a=o(!1),n=o(!0),d=["MakeAWish","FangZhen","JiYunfu","KidoKana","HuangYanyan"],s=me(()=>!(!_.value&&i.value.length===0&&T.value.length===0&&Z.value.length===0));I.value=[{label:"435",value:"MedicineIsNot"}];const w=o([]),z=async()=>{try{const h=N(y,"players"),c=await L(h),S=[],F=[],q=[];c.forEach(K=>{const j=K.data();if(j.remain){const Y={label:j.name,value:j.character};F.push(Y)}else{const Y={label:j.name,value:j.character};S.push(Y)}const te={label:j.name,value:j.character};q.push(te)}),C.value=q,console.log(C.value),w.value=[{type:"group",label:"本輪已行動的玩家",key:"acted",children:S},{type:"group",label:"本輪還未行動的玩家",key:"pending",children:F}]}catch{}},V=async()=>{try{console.log(f.value);const h=N(y,`ReadomAnimalForRound${f.value}`),c=await L(h),S=[];c.forEach(F=>{const q=F.data(),K={name:q.name,value:q.value,view_value:q.view_value};S.push(K)}),console.log(S),M.value=S}catch{}},J=async h=>{try{const c=ee(y,`ReadomAnimalForRound${f.value}`,h),S=await he(c);if(S.exists()){const F=S.data().view_value;F>=0&&await we(c,{view_value:F===1?0:1},{merge:!0})}else console.warn("無對應資料")}catch(c){console.error("老嘲諷技能問題: ",c)}},g=async h=>{if(h)try{(await L(N(y,`ReadomAnimalForRound${f.value}`))).forEach(S=>{J(S.id)})}catch(c){console.error("老嘲諷技能問題: ",c)}},e=async h=>{try{const c=Q(N(y,`ReadomAnimalForRound${f.value}`),le("name","==",h));let F=(await L(c)).docs.map(q=>{q.data().value===1?ne(q.ref,{value:-1,view_value:-1}):q.data().value===0&&ne(q.ref,{value:-2,view_value:-2})});await Promise.all(F)}catch{}},k=async h=>{de(y,"players","character",h,"attacked",1),h==="FangZhen"&&de(y,"players","character","MakeAWish","attacked",1)},E=async h=>{B.value=`此玩家是${d.includes(h)?"好人":"壞人"}`},t=async()=>{if(l.value.isSkillAble>f.value)P.warning("本輪已使用過");else if(l.value.attacked>0)P.warning("你被藥不然偷襲了!!!",{closable:!0,duration:0}),n.value=!1,oe(y,"players","name",l.value.name,"isSkillAble",f.value+1);else{switch(l.value.character){case"LaoChaofeng":a.value=!0,await g(_.value),r.value=!1,a.value=!1;break;case"MedicineIsNot":a.value=!0,await k(i.value),r.value=!1,a.value=!1;break;case"ZhengGuoqu":a.value=!0,await e(T.value),r.value=!1,a.value=!1;break;case"FangZhen":a.value=!0,await E(Z.value),n.value=!1,a.value=!1;break}oe(y,"players","name",l.value.name,"isSkillAble",f.value+1)}};return ve(()=>r.value,h=>{h===!0&&(l.value.isSkillAble<=f.value?n.value=!0:n.value=!1),l.value.character==="ZhengGuoqu"&&V(),(l.value.character==="FangZhen"||l.value.character==="MedicineIsNot")&&z()}),(h,c)=>{const S=m("n-checkbox"),F=m("n-radio"),q=m("n-space"),K=m("n-radio-group"),j=m("n-select"),te=m("n-button"),Y=m("n-card"),pe=m("n-modal");return p(),R(pe,{show:r.value,"onUpdate:show":c[6]||(c[6]=D=>r.value=D)},{default:u(()=>[v(Y,{style:{width:"400px"},title:"使用技能",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:u(()=>[A("div",qe,[A("div",null,[v(te,{size:"large",onClick:c[4]||(c[4]=D=>r.value=!1)},{default:u(()=>[$("返回")]),_:1})]),A("div",null,[n.value?(p(),R(te,{key:0,size:"large",type:"primary",loading:a.value,disabled:!s.value,onClick:c[5]||(c[5]=D=>t())},{default:u(()=>[$("確認")]),_:1},8,["loading","disabled"])):O("",!0)])])]),default:u(()=>[l.value.character==="LaoChaofeng"?(p(),W("div",Ae,[v(S,{checked:_.value,"onUpdate:checked":c[0]||(c[0]=D=>_.value=D)},{default:u(()=>[$(" 之後玩家看到的真假互換(同陣營和姬雲浮不適用) ")]),_:1},8,["checked"])])):l.value.character==="ZhengGuoqu"?(p(),W("div",Se,[v(K,{value:T.value,"onUpdate:value":c[1]||(c[1]=D=>T.value=D),name:"radiogroup"},{default:u(()=>[v(q,null,{default:u(()=>[(p(!0),W(ie,null,ce(M.value,D=>(p(),R(F,{key:D.name,value:D.name,label:D.name},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])])):l.value.character==="MedicineIsNot"?(p(),R(j,{key:2,value:i.value,"onUpdate:value":c[2]||(c[2]=D=>i.value=D),options:w.value},null,8,["value","options"])):l.value.character==="FangZhen"?(p(),R(j,{key:3,value:Z.value,"onUpdate:value":c[3]||(c[3]=D=>Z.value=D),options:C.value},null,8,["value","options"])):O("",!0),B.value.length!==0?(p(),R(Y,{key:4,title:"鑑定結果"},{default:u(()=>[$(X(B.value),1)]),_:1})):O("",!0)]),_:1})]),_:1},8,["show"])}}}),Ie={class:"flex justify-end mt-8"},Pe=ae({__name:"VoteModal",props:{showModal:{},showModalModifiers:{},currentRound:{},currentRoundModifiers:{},playerData:{},playerDataModifiers:{}},emits:["update:showModal","update:currentRound","update:playerData"],setup(U){const P=ue();re();const b=se(),C=o();C.value=P.params.roomId;const I=ee(H,"rooms",C.value),x=G(U,"showModal"),y=G(U,"currentRound");G(U,"playerData");const r=o(),f=o(),l=o(null),M=o(""),_=o(!0),i=o(!1),T=async()=>{try{console.log(y.value);const a=N(I,`ReadomAnimalForRound${y.value}`),n=await L(a),d=[];n.forEach(s=>{const w=s.data(),z={label:w.name,value:w.value};d.push(z)}),console.log(d),r.value=d,f.value=d.map(s=>({label:s.label,value:s.label.toString()}))}catch{}},Z=async()=>{try{const a=Q(N(I,"players"));let d=(await L(a)).docs.map(s=>{s.data().myTurn===0?ne(s.ref,{remain:1}):s.data().myTurn===1&&s.data().attacked>0&&ne(s.ref,{attacked:ge(-1)})});await Promise.all(d)}catch{}},B=async()=>{let a=null;if(l.value.length===0||l.value===null)b.warning("請選擇至少一隻動物");else{const n=typeof l.value=="string"?[l.value]:l.value;console.log(l.value),a=r.value.filter(s=>n.some(w=>w===s.label));let d=[];d.push(`${a[0].label}被掩蓋了`),d.push(`${a[1].label}是${Number(a[1].value)>=0?a[1].value?"真的":"假的":a[1].value===-1?"真的":"假的"}`),M.value=d.join(`
`),console.log(M.value),_.value=!1,i.value=!0}};return ve(()=>x.value,a=>{a===!0?(T(),_.value=!0):i.value&&a===!1&&(de(H,"rooms","roomId",C.value,"currentRound",1),Z(),l.value=null)}),(a,n)=>{const d=m("n-select"),s=m("n-button"),w=m("n-card"),z=m("n-modal");return p(),R(z,{show:x.value,"onUpdate:show":n[3]||(n[3]=V=>x.value=V),"mask-closable":!0},{default:u(()=>[v(w,{style:{width:"400px"},title:"投票",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:u(()=>[A("div",Ie,[A("div",null,[v(s,{size:"large",type:"warning",onClick:n[1]||(n[1]=V=>x.value=!1)},{default:u(()=>[$(X(`${i.value?"前往下一回合":"返回"}`),1)]),_:1})]),A("div",null,[_.value?(p(),R(s,{key:0,size:"large",type:"primary",onClick:n[2]||(n[2]=V=>B())},{default:u(()=>[$("確認")]),_:1})):O("",!0)])])]),default:u(()=>[v(d,{value:l.value,"onUpdate:value":n[0]||(n[0]=V=>l.value=V),options:f.value,multiple:""},null,8,["value","options"]),M.value.length!==0?(p(),R(w,{key:0,title:"鑑定結果"},{default:u(()=>[$(X(M.value),1)]),_:1})):O("",!0)]),_:1})]),_:1},8,["show"])}}}),ze={class:"w-10/12 max-w-sm mt-28 mx-auto text-center"},Ve={class:"text-3xl"},Fe={class:"flex flex-col h-auto justify-around"},Ne={class:"flex flex-col items-center"},Ee=ae({__name:"Game",setup(U){const P=ue();re();const b=se(),C=o();C.value=P.params.roomId;const I=ee(H,"rooms",C.value),x=o();x.value=P.query.player;const y=me(()=>P.query.host==="1"),r=o(0);o(1);const f=o(!1),l=o(!1),M=o(!1),_=o(!1),i=o(),T=o(""),Z=["LaoChaofeng","MedicineIsNot"],B=async()=>{try{const g=N(I,"players"),e=await L(g);let k=0;return e.forEach(E=>{E.data().remain&&++k}),console.log(k),k}catch{return-1}},a=async()=>{try{const g=Q(N(I,"players"),le("name","==",x.value));return(await L(g)).docs[0].data()}catch{}},n=async g=>{try{const e=Q(N(I,"players"),le("character","==",g));return(await L(e)).docs[0].data()}catch{}},d=async()=>{try{const g=Q(N(H,"rooms"),le("roomId","==",C.value));return(await L(g)).docs[0].data().currentRound}catch{}},s=async()=>{const g=await a();if(!Z.includes(g.character))b.warning("你沒有隊友");else if(g.character==="LaoChaofeng"){const e=await n("MedicineIsNot");b.success(`你的隊友是${e.name}`)}else if(g.character==="MedicineIsNot"){const e=await n("LaoChaofeng");b.success(`你的隊友是${e.name}`)}},w=async()=>{i.value=await a(),i.value.character==="FangZhen"?b.warning("你沒有鑑寶能力"):i.value.myTurn===1?(r.value=await d(),l.value=!0):b.warning("還沒有到你的回合")},z=async()=>{i.value=await a(),i.value.myTurn===1?(T.value=i.value.character,r.value=await d(),M.value=!0):b.warning("還沒有到你的回合")},V=async()=>{i.value=await a(),i.value.myTurn===1?f.value=!0:b.warning("還沒有到你的回合")},J=async()=>{i.value=await a(),await B()===0?(r.value=await d(),_.value=!0):b.warning("還有玩家未行動")};return ye(async()=>{}),(g,e)=>{const k=m("n-button"),E=m("n-icon");return p(),W("div",ze,[A("p",Ve,"房號："+X(C.value),1),A("div",Fe,[v(k,{class:"text-4xl h-14 mt-8",type:"primary",size:"large",onClick:e[0]||(e[0]=t=>s())},{default:u(()=>[$("查看隊友")]),_:1}),v(k,{class:"text-4xl h-14 mt-8",type:"primary",size:"large",onClick:e[1]||(e[1]=t=>w())},{default:u(()=>[$("鑑定古董")]),_:1}),v(k,{class:"text-4xl h-14 mt-8",type:"primary",size:"large",onClick:e[2]||(e[2]=t=>z())},{default:u(()=>[$("使用技能")]),_:1}),v(k,{class:"text-4xl h-14 mt-8",type:"primary",size:"large",onClick:e[3]||(e[3]=t=>V())},{default:u(()=>[$("選擇下一位玩家")]),_:1}),y.value?(p(),R(k,{key:0,class:"text-4xl h-14 mt-8",type:"warning",size:"large",onClick:e[4]||(e[4]=t=>J())},{default:u(()=>[$("投票")]),_:1})):O("",!0)]),A("div",Ne,[v(k,{onClick:e[5]||(e[5]=()=>{}),circle:"",class:"w-20 h-20 absolute bottom-20",dashed:"",type:"info"},{icon:u(()=>[v(E,{class:"text-6xl"},{default:u(()=>[v(fe(xe))]),_:1})]),_:1})]),v($e,{showModal:l.value,"onUpdate:showModal":e[6]||(e[6]=t=>l.value=t),currentRound:r.value,"onUpdate:currentRound":e[7]||(e[7]=t=>r.value=t),playerData:i.value,"onUpdate:playerData":e[8]||(e[8]=t=>i.value=t)},null,8,["showModal","currentRound","playerData"]),v(Ue,{showModal:M.value,"onUpdate:showModal":e[9]||(e[9]=t=>M.value=t),currentRound:r.value,"onUpdate:currentRound":e[10]||(e[10]=t=>r.value=t),playerData:i.value,"onUpdate:playerData":e[11]||(e[11]=t=>i.value=t)},null,8,["showModal","currentRound","playerData"]),v(_e,{showModal:f.value,"onUpdate:showModal":e[12]||(e[12]=t=>f.value=t),playerData:i.value,"onUpdate:playerData":e[13]||(e[13]=t=>i.value=t)},null,8,["showModal","playerData"]),v(Pe,{showModal:_.value,"onUpdate:showModal":e[14]||(e[14]=t=>_.value=t),currentRound:r.value,"onUpdate:currentRound":e[15]||(e[15]=t=>r.value=t),playerData:i.value,"onUpdate:playerData":e[16]||(e[16]=t=>i.value=t)},null,8,["showModal","currentRound","playerData"])])}}});export{Ee as default};
