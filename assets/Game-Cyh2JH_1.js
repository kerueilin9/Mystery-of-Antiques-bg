import{d as ae,o as f,c as Y,g as S,h as se,r as n,l as O,m as ve,a as y,n as C,w as o,b as p,e as A,p as W,q as ce,F as ie,t as X,k as ue,u as re,i as me,s as ye,f as fe}from"./index-D52xPFLW.js";import{d as ee,a as J,c as L,g as T,q as Q,w as le,u as ne,b as he,s as we,i as ge}from"./firebaseConfig-BxjB4Upe.js";import{s as oe,i as de,_ as _e}from"./SelectModal.vue_vue_type_script_setup_true_lang-Dml34RE5.js";const ke={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},be=S("path",{d:"M384 224v184a40 40 0 0 1-40 40H104a40 40 0 0 1-40-40V168a40 40 0 0 1 40-40h167.48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),Me=S("path",{d:"M459.94 53.25a16.06 16.06 0 0 0-23.22-.56L424.35 65a8 8 0 0 0 0 11.31l11.34 11.32a8 8 0 0 0 11.34 0l12.06-12c6.1-6.09 6.67-16.01.85-22.38z",fill:"currentColor"},null,-1),Re=S("path",{d:"M399.34 90L218.82 270.2a9 9 0 0 0-2.31 3.93L208.16 299a3.91 3.91 0 0 0 4.86 4.86l24.85-8.35a9 9 0 0 0 3.93-2.31L422 112.66a9 9 0 0 0 0-12.66l-9.95-10a9 9 0 0 0-12.71 0z",fill:"currentColor"},null,-1),Ce=[be,Me,Re],xe=ae({name:"CreateOutline",render:function(V,g){return f(),Y("svg",ke,Ce)}}),De={class:"flex justify-end mt-8"},$e=ae({__name:"CheckAntiquesModal",props:{showModal:{},showModalModifiers:{},currentRound:{},currentRoundModifiers:{},playerData:{},playerDataModifiers:{}},emits:["update:showModal","update:currentRound","update:playerData"],setup(I){const V=ue();re();const g=se(),x=n();x.value=V.params.roomId;const z=ee(J,"rooms",x.value),D=O(I,"showModal"),h=O(I,"currentRound"),u=O(I,"playerData"),m=n(),t=n(null),M=n(""),k=n(!0),r=["JiYunfu","MedicineIsNot","ZhengGuoqu","LaoChaofeng"],F=async()=>{try{console.log(h.value);const c=L(z,`ReadomAnimalForRound${h.value}`),l=await T(c),s=[];l.forEach(v=>{const d=v.data(),R={name:d.name,value:d.value,view_value:d.view_value};s.push(R)}),console.log(s),m.value=s}catch{}},Z=async()=>{let c=null;if(t.value.length===0||t.value===null)g.warning("請選擇至少一隻動物");else if(u.value.isCheckAble>h.value)g.warning("本輪已查看過，請勿作弊");else if(u.value.attacked>0)g.warning("你被藥不然偷襲了!!!",{closable:!0,duration:0}),k.value=!1,oe(z,"players","name",u.value.name,"isCheckAble",h.value+1);else{const l=typeof t.value=="string"?[t.value]:t.value;c=m.value.filter(v=>l.some(d=>d===v.name));let s=[];r.includes(u.value.character)?c.forEach(v=>{s.push(`${v.name}是${v.value>=0?v.value?"真的":"假的":"什麼鬼"}`)}):c.forEach(v=>{s.push(`${v.name}是${v.view_value>=0&&u.value.inActiveRound!==h.value?v.view_value?"真的":"假的":"什麼鬼"}`)}),M.value=s.join(`
`),console.log(M.value),k.value=!1,oe(z,"players","name",u.value.name,"isCheckAble",h.value+1)}},G=c=>{t.value=c};return ve(()=>D.value,c=>{c===!0&&(M.value="",F(),u.value.isCheckAble<=h.value?k.value=!0:k.value=!1)}),(c,l)=>{const s=y("n-radio"),v=y("n-space"),d=y("n-radio-group"),R=y("n-checkbox"),E=y("n-gi"),P=y("n-grid"),_=y("n-checkbox-group"),e=y("n-button"),b=y("n-card"),j=y("n-modal");return f(),C(j,{show:D.value,"onUpdate:show":l[3]||(l[3]=a=>D.value=a),"mask-closable":!0},{default:o(()=>[p(b,{style:{width:"400px"},title:"鑑定古董",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:o(()=>[S("div",De,[S("div",null,[p(e,{size:"large",onClick:l[1]||(l[1]=a=>D.value=!1)},{default:o(()=>[A("返回")]),_:1})]),S("div",null,[k.value?(f(),C(e,{key:0,size:"large",type:"primary",onClick:l[2]||(l[2]=a=>Z())},{default:o(()=>[A("確認")]),_:1})):W("",!0)])])]),default:o(()=>[u.value.character!=="MakeAWish"?(f(),C(d,{key:0,value:t.value,"onUpdate:value":l[0]||(l[0]=a=>t.value=a),name:"radiogroup"},{default:o(()=>[p(v,null,{default:o(()=>[(f(!0),Y(ie,null,ce(m.value,a=>(f(),C(s,{key:a.name,value:a.name,label:a.name},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])):(f(),C(_,{key:1,max:2,"onUpdate:value":G},{default:o(()=>[p(P,{"y-gap":8,cols:2},{default:o(()=>[(f(!0),Y(ie,null,ce(m.value,(a,w)=>(f(),C(E,{key:w},{default:o(()=>[p(R,{value:a.name,label:a.name},null,8,["value","label"])]),_:2},1024))),128))]),_:1})]),_:1})),M.value.length!==0?(f(),C(b,{key:2,title:"鑑定結果"},{default:o(()=>[A(X(M.value),1)]),_:1})):W("",!0)]),_:1})]),_:1},8,["show"])}}}),Ae={key:0},Se={key:1},qe={class:"flex justify-end mt-8"},Ue=ae({__name:"SkillModal",props:{showModal:{},showModalModifiers:{},currentRound:{},currentRoundModifiers:{},playerData:{},playerDataModifiers:{}},emits:["update:showModal","update:currentRound","update:playerData"],setup(I){const V=se(),g=ue();re();const x=n(),z=n(),D=n();D.value=g.params.roomId;const h=ee(J,"rooms",D.value),u=O(I,"showModal"),m=O(I,"currentRound"),t=O(I,"playerData"),M=n(),k=n(!1),r=n(""),F=n(""),Z=n(""),G=n(""),c=n(!1),l=n(!0),s=["MakeAWish","FangZhen","JiYunfu","KidoKana","HuangYanyan"],v=me(()=>!(!k.value&&r.value.length===0&&F.value.length===0&&Z.value.length===0));z.value=[{label:"435",value:"MedicineIsNot"}];const d=n([]),R=async()=>{try{const w=L(h,"players"),i=await T(w),q=[],N=[],U=[];i.forEach(K=>{const B=K.data();if(B.remain){const H={label:B.name,value:B.character};N.push(H)}else{const H={label:B.name,value:B.character};q.push(H)}const te={label:B.name,value:B.character};U.push(te)}),x.value=U,console.log(x.value),d.value=[{type:"group",label:"本輪已行動的玩家",key:"acted",children:q},{type:"group",label:"本輪還未行動的玩家",key:"pending",children:N}]}catch{}},E=async()=>{try{console.log(m.value);const w=L(h,`ReadomAnimalForRound${m.value}`),i=await T(w),q=[];i.forEach(N=>{const U=N.data(),K={name:U.name,value:U.value,view_value:U.view_value};q.push(K)}),console.log(q),M.value=q}catch{}},P=async w=>{try{const i=ee(h,`ReadomAnimalForRound${m.value}`,w),q=await he(i);if(q.exists()){const N=q.data().view_value;N>=0&&await we(i,{view_value:N===1?0:1},{merge:!0})}else console.warn("無對應資料")}catch(i){console.error("老嘲諷技能問題: ",i)}},_=async w=>{if(w)try{(await T(L(h,`ReadomAnimalForRound${m.value}`))).forEach(q=>{P(q.id)})}catch(i){console.error("老嘲諷技能問題: ",i)}},e=async w=>{try{const i=Q(L(h,`ReadomAnimalForRound${m.value}`),le("name","==",w));let N=(await T(i)).docs.map(U=>{U.data().value===1?ne(U.ref,{value:-1,view_value:-1}):U.data().value===0&&ne(U.ref,{value:-2,view_value:-2})});await Promise.all(N)}catch{}},b=async w=>{de(h,"players","character",w,"attacked",1),w==="FangZhen"&&de(h,"players","character","MakeAWish","attacked",1)},j=async w=>{G.value=`此玩家是${s.includes(w)?"好人":"壞人"}`},a=async()=>{if(t.value.isSkillAble>m.value)V.warning("本輪已使用過");else if(t.value.attacked>0)V.warning("你被藥不然偷襲了!!!",{closable:!0,duration:0}),l.value=!1,oe(h,"players","name",t.value.name,"isSkillAble",m.value+1);else{switch(t.value.character){case"LaoChaofeng":c.value=!0,await _(k.value),u.value=!1,c.value=!1;break;case"MedicineIsNot":c.value=!0,await b(r.value),u.value=!1,c.value=!1;break;case"ZhengGuoqu":c.value=!0,await e(F.value),u.value=!1,c.value=!1;break;case"FangZhen":c.value=!0,await j(Z.value),l.value=!1,c.value=!1;break}oe(h,"players","name",t.value.name,"isSkillAble",m.value+1)}};return ve(()=>u.value,w=>{w===!0&&(t.value.isSkillAble<=m.value?l.value=!0:l.value=!1),t.value.character==="ZhengGuoqu"&&E(),(t.value.character==="FangZhen"||t.value.character==="MedicineIsNot")&&R()}),(w,i)=>{const q=y("n-checkbox"),N=y("n-radio"),U=y("n-space"),K=y("n-radio-group"),B=y("n-select"),te=y("n-button"),H=y("n-card"),pe=y("n-modal");return f(),C(pe,{show:u.value,"onUpdate:show":i[6]||(i[6]=$=>u.value=$)},{default:o(()=>[p(H,{style:{width:"400px"},title:"使用技能",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:o(()=>[S("div",qe,[S("div",null,[p(te,{size:"large",onClick:i[4]||(i[4]=$=>u.value=!1)},{default:o(()=>[A("返回")]),_:1})]),S("div",null,[l.value?(f(),C(te,{key:0,size:"large",type:"primary",loading:c.value,disabled:!v.value,onClick:i[5]||(i[5]=$=>a())},{default:o(()=>[A("確認")]),_:1},8,["loading","disabled"])):W("",!0)])])]),default:o(()=>[t.value.character==="LaoChaofeng"?(f(),Y("div",Ae,[p(q,{checked:k.value,"onUpdate:checked":i[0]||(i[0]=$=>k.value=$)},{default:o(()=>[A(" 之後玩家看到的真假互換(同陣營和姬雲浮不適用) ")]),_:1},8,["checked"])])):t.value.character==="ZhengGuoqu"?(f(),Y("div",Se,[p(K,{value:F.value,"onUpdate:value":i[1]||(i[1]=$=>F.value=$),name:"radiogroup"},{default:o(()=>[p(U,null,{default:o(()=>[(f(!0),Y(ie,null,ce(M.value,$=>(f(),C(N,{key:$.name,value:$.name,label:$.name},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])])):t.value.character==="MedicineIsNot"?(f(),C(B,{key:2,value:r.value,"onUpdate:value":i[2]||(i[2]=$=>r.value=$),options:d.value},null,8,["value","options"])):t.value.character==="FangZhen"?(f(),C(B,{key:3,value:Z.value,"onUpdate:value":i[3]||(i[3]=$=>Z.value=$),options:x.value},null,8,["value","options"])):W("",!0),G.value.length!==0?(f(),C(H,{key:4,title:"鑑定結果"},{default:o(()=>[A(X(G.value),1)]),_:1})):W("",!0)]),_:1})]),_:1},8,["show"])}}}),Ie={class:"flex justify-end mt-8"},Pe=ae({__name:"VoteModal",props:{showModal:{},showModalModifiers:{},currentRound:{},currentRoundModifiers:{},playerData:{},playerDataModifiers:{}},emits:["update:showModal","update:currentRound","update:playerData"],setup(I){const V=ue();re();const g=se(),x=n();x.value=V.params.roomId;const z=ee(J,"rooms",x.value),D=O(I,"showModal"),h=O(I,"currentRound");O(I,"playerData");const u=n(),m=n(),t=n(null),M=n(""),k=n(!0),r=n(!1),F=async l=>{try{const s=L(z,`ReadomAnimalForRound${l}`),v=await T(s),d=[];v.forEach(R=>{const E=R.data(),P={label:E.name,value:E.value};d.push(P)}),console.log(d),u.value=d,m.value=d.map(R=>({label:R.label,value:R.label.toString()}))}catch{}},Z=async()=>{try{const l=Q(L(z,"players"));let v=(await T(l)).docs.map(d=>{d.data().myTurn===0?ne(d.ref,{remain:1}):d.data().myTurn===1&&d.data().attacked>0&&ne(d.ref,{attacked:ge(-1)})});await Promise.all(v)}catch{}},G=async()=>{let l=null;if(t.value.length===0||t.value===null)g.warning("請選擇至少一隻動物");else{const s=typeof t.value=="string"?[t.value]:t.value;console.log(t.value),l=u.value.filter(d=>s.some(R=>R===d.label));let v=[];v.push(`${l[0].label}被掩蓋了`),v.push(`${l[1].label}是${Number(l[1].value)>=0?l[1].value?"真的":"假的":l[1].value===-1?"真的":"假的"}`),M.value=v.join(`
`),console.log(M.value),k.value=!1,r.value=!0}},c=async()=>{h.value===3?g.success("遊戲結束"):r.value&&(await F(h.value+1),await de(J,"rooms","roomId",x.value,"currentRound",1),await Z(),g.success(`下一回合的動物${m.value[0].label}，${m.value[1].label}，${m.value[2].label}，${m.value[3].label}`,{closable:!0,duration:0})),D.value=!1,t.value=null};return ve(()=>D.value,l=>{l===!0&&(F(h.value),k.value=!0,r.value=!1)}),(l,s)=>{const v=y("n-select"),d=y("n-button"),R=y("n-card"),E=y("n-modal");return f(),C(E,{show:D.value,"onUpdate:show":s[3]||(s[3]=P=>D.value=P),"mask-closable":!0},{default:o(()=>[p(R,{style:{width:"400px"},title:"投票",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:o(()=>[S("div",Ie,[S("div",null,[p(d,{size:"large",type:"warning",onClick:s[1]||(s[1]=P=>c())},{default:o(()=>[A(X(`${r.value?"前往下一回合":"返回"}`),1)]),_:1})]),S("div",null,[k.value?(f(),C(d,{key:0,size:"large",type:"primary",onClick:s[2]||(s[2]=P=>G())},{default:o(()=>[A("確認")]),_:1})):W("",!0)])])]),default:o(()=>[p(v,{value:t.value,"onUpdate:value":s[0]||(s[0]=P=>t.value=P),options:m.value,multiple:""},null,8,["value","options"]),M.value.length!==0?(f(),C(R,{key:0,title:"鑑定結果"},{default:o(()=>[A(X(M.value),1)]),_:1})):W("",!0)]),_:1})]),_:1},8,["show"])}}}),ze={class:"w-10/12 max-w-sm mt-28 mx-auto text-center"},Ve={class:"text-3xl"},Fe={class:"flex flex-col h-auto justify-around"},Ne={class:"flex flex-col items-center"},Ee=ae({__name:"Game",setup(I){const V=ue();re();const g=se(),x=n();x.value=V.params.roomId;const z=ee(J,"rooms",x.value),D=n();D.value=V.query.player;const h=me(()=>V.query.host==="1"),u=n(0);n(1);const m=n(!1),t=n(!1),M=n(!1),k=n(!1),r=n(),F=n(""),Z=["LaoChaofeng","MedicineIsNot"],G=async()=>{try{const _=L(z,"players"),e=await T(_);let b=0;return e.forEach(j=>{j.data().remain&&++b}),console.log(b),b}catch{return-1}},c=async()=>{try{const _=Q(L(z,"players"),le("name","==",D.value));return(await T(_)).docs[0].data()}catch{}},l=async _=>{try{const e=Q(L(z,"players"),le("character","==",_));return(await T(e)).docs[0].data()}catch{}},s=async()=>{try{const _=Q(L(J,"rooms"),le("roomId","==",x.value));return(await T(_)).docs[0].data().currentRound}catch{}},v=async()=>{const _=await c();if(!Z.includes(_.character))g.warning("你沒有隊友");else if(_.character==="LaoChaofeng"){const e=await l("MedicineIsNot");g.success(`你的隊友是${e.name}`)}else if(_.character==="MedicineIsNot"){const e=await l("LaoChaofeng");g.success(`你的隊友是${e.name}`)}},d=async()=>{r.value=await c(),r.value.character==="FangZhen"?g.warning("你沒有鑑寶能力"):r.value.myTurn===1?(u.value=await s(),t.value=!0):g.warning("還沒有到你的回合")},R=async()=>{r.value=await c(),r.value.myTurn===1?(F.value=r.value.character,u.value=await s(),M.value=!0):g.warning("還沒有到你的回合")},E=async()=>{r.value=await c(),r.value.myTurn===1?m.value=!0:g.warning("還沒有到你的回合")},P=async()=>{r.value=await c(),await G()===0?(u.value=await s(),k.value=!0):g.warning("還有玩家未行動")};return ye(async()=>{}),(_,e)=>{const b=y("n-button"),j=y("n-icon");return f(),Y("div",ze,[S("p",Ve,"房號："+X(x.value),1),S("div",Fe,[p(b,{class:"text-4xl h-14 mt-8",type:"primary",size:"large",onClick:e[0]||(e[0]=a=>v())},{default:o(()=>[A("查看隊友")]),_:1}),p(b,{class:"text-4xl h-14 mt-8",type:"primary",size:"large",onClick:e[1]||(e[1]=a=>d())},{default:o(()=>[A("鑑定古董")]),_:1}),p(b,{class:"text-4xl h-14 mt-8",type:"primary",size:"large",onClick:e[2]||(e[2]=a=>R())},{default:o(()=>[A("使用技能")]),_:1}),p(b,{class:"text-4xl h-14 mt-8",type:"primary",size:"large",onClick:e[3]||(e[3]=a=>E())},{default:o(()=>[A("選擇下一位玩家")]),_:1}),h.value?(f(),C(b,{key:0,class:"text-4xl h-14 mt-8",type:"warning",size:"large",onClick:e[4]||(e[4]=a=>P())},{default:o(()=>[A("投票")]),_:1})):W("",!0)]),S("div",Ne,[p(b,{onClick:e[5]||(e[5]=()=>{}),circle:"",class:"w-20 h-20 absolute bottom-20",dashed:"",type:"info"},{icon:o(()=>[p(j,{class:"text-6xl"},{default:o(()=>[p(fe(xe))]),_:1})]),_:1})]),p($e,{showModal:t.value,"onUpdate:showModal":e[6]||(e[6]=a=>t.value=a),currentRound:u.value,"onUpdate:currentRound":e[7]||(e[7]=a=>u.value=a),playerData:r.value,"onUpdate:playerData":e[8]||(e[8]=a=>r.value=a)},null,8,["showModal","currentRound","playerData"]),p(Ue,{showModal:M.value,"onUpdate:showModal":e[9]||(e[9]=a=>M.value=a),currentRound:u.value,"onUpdate:currentRound":e[10]||(e[10]=a=>u.value=a),playerData:r.value,"onUpdate:playerData":e[11]||(e[11]=a=>r.value=a)},null,8,["showModal","currentRound","playerData"]),p(_e,{showModal:m.value,"onUpdate:showModal":e[12]||(e[12]=a=>m.value=a),playerData:r.value,"onUpdate:playerData":e[13]||(e[13]=a=>r.value=a)},null,8,["showModal","playerData"]),p(Pe,{showModal:k.value,"onUpdate:showModal":e[14]||(e[14]=a=>k.value=a),currentRound:u.value,"onUpdate:currentRound":e[15]||(e[15]=a=>u.value=a),playerData:r.value,"onUpdate:playerData":e[16]||(e[16]=a=>r.value=a)},null,8,["showModal","currentRound","playerData"])])}}});export{Ee as default};
