import{d as A,f as E,r as t,l as T,m as z,a as y,o as G,c as W,j as Z,t as F,b as d,w as m,e as K,p as O,u as Q}from"./index-PhVZ6tUK.js";import{d as U,a as q,c as p,g as v,q as C,w as x,r as H,b as J,e as X,o as Y,i as ee,j as ae}from"./firebaseConfig-BR434puB.js";import{a as oe,d as c}from"./setFirebaseData-DDiyQXTP.js";const te={class:"w-10/12 max-w-sm mt-8 mx-auto text-center"},se={class:"text-3xl"},ne="/Mystery-of-Antiques-bg",ie=A({__name:"Vote",setup(re){const i=O(),S=Q(),D=E(),o=t();o.value=i.params.roomId;const f=U(q,"rooms",o.value),h=t();h.value=i.query.player;const g=T(()=>i.query.host==="1"),V=t(!1),w=t();t(4);const u=t(""),_=t(!0);t(1);const b=t();t("");const k=async()=>{try{const e=p(f,"players"),a=await v(e),s=[];a.forEach(r=>{const n=r.data(),l={label:n.name,value:n.character};s.push(l)}),w.value=s}catch{}},P=async e=>{try{const a=C(p(f,"players"),x("name","==",e));return(await v(a)).docs[0].data()}catch(a){console.log(a)}},I=async()=>{try{u.value==="MakeAWish"?await c(o.value,"score",-2):await c(o.value,"score",2)}catch(e){console.log("老朝奉鑑人問題："+e)}},R=async()=>{try{u.value==="FangZhen"?await c(o.value,"score",-1):await c(o.value,"score",1)}catch(e){console.log("藥不然鑑人問題："+e)}},B=async()=>{try{u.value==="LaoChaofeng"&&await c(o.value,"voteLaoChaofeng",1)}catch(e){console.log("好人鑑人問題："+e)}},L=async()=>{if(u.value==="")D.warning("請選擇玩家");else{switch(_.value=!1,b.value.character){case"LaoChaofeng":await I();break;case"MedicineIsNot":await R();break;case"ZhengGuoqu":break;default:await B();break}await oe(o.value,"votedPlayerCount",1)}},M=async()=>{const e=C(p(q,"rooms"),x("roomId","==",o.value));(await v(e)).docs[0].data().voteLaoChaofeng>=3&&g.value?await c(o.value,"score",1):g.value&&await c(o.value,"score",-1),S.push({path:`${ne}/endGame/${o.value}`,query:{...i.query}})},j=async e=>{try{const a=H(J,"rooms"),s=X(a,Y("roomId"),ee(e));ae(s,async r=>{if(r.exists()){const n=r.val(),l=Object.keys(n)[0],N=n[l].playerCount||0,$=n[l].votedPlayerCount||0;N===$&&await M()}else console.log("roomId not found")})}catch(a){console.error("Error querying roomId",a)}};return z(async()=>{await j(o.value),await k(),b.value=await P(String(h.value))}),(e,a)=>{const s=y("n-card"),r=y("n-select"),n=y("n-button");return G(),W("div",te,[Z("p",se,"房號："+F(o.value),1),d(s,{title:"前三輪投票結果",class:"flex flex-col justify-around h-2/5 mt-8"}),d(s,{title:"鑑人投票",class:"flex flex-col justify-around mt-8",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:m(()=>[d(n,{loading:V.value,disabled:!_.value,size:"large",type:"primary",onClick:a[1]||(a[1]=l=>L())},{default:m(()=>[K("確認")]),_:1},8,["loading","disabled"])]),default:m(()=>[d(r,{value:u.value,"onUpdate:value":a[0]||(a[0]=l=>u.value=l),options:w.value},null,8,["value","options"])]),_:1})])}}});export{ie as default};
