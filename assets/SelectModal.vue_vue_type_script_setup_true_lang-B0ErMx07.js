import{c as P,q as M,w as _,g as v,u as q,i as A,d as B,a as U}from"./firebaseConfig-BxjB4Upe.js";import{d as j,k as E,r as g,h as I,l as R,m as G,a as k,o as H,n as L,w as C,b as x,e as F,j as J,u as K}from"./index-CuIsaB5c.js";const O=async(u,h,n,w,c,a)=>{const i=P(u,h);let m=M(i,_(n,"==",w)),p=(await v(m)).docs.map(f=>q(f.ref,{[c]:A(a)}));await Promise.all(p)},Y=async(u,h,n,w,c,a)=>{const i=P(u,h);let m=M(i,_(n,"==",w));const p=(await v(m)).docs.map(f=>q(f.ref,{[c]:a}));await Promise.all(p)},Q="/Mystery-of-Antiques-bg",Z=j({__name:"SelectModal",props:{showModal:{},showModalModifiers:{},playerData:{},playerDataModifiers:{},name:{},nameModifiers:{}},emits:["update:showModal","update:playerData","update:name"],setup(u){const h=E(),n=J(),w=K(),c=g(),a=g(""),i=g(!1),m=g();m.value=n.params.roomId;const d=B(U,"rooms",m.value),p=g("");p.value=String(n.query.player);const f=I(()=>n.query.host==="1"),b=R(u,"showModal"),S=R(u,"playerData"),N=R(u,"name"),D=I(()=>!(f.value&&n.fullPath.includes("room"))),$=async()=>{try{const s=P(d,"players"),e=await v(s),t=[];e.forEach(r=>{const o=r.data();if(o.remain){const l={label:o.name,value:o.character};t.push(l)}}),c.value=t,console.log(c.value)}catch{}},T=async s=>{const e=P(d,"players");let t=M(e,_("character","==",s)),o=(await v(t)).docs.map(l=>q(l.ref,{remain:0}));await Promise.all(o)},V=async s=>{const e=P(d,"players");let t=M(e,_("character","==",s)),r=await v(t);const o=r.docs.map(l=>q(l.ref,{myTurn:1}));if(await Promise.all(o),D.value){t=M(e,_("name","==",p.value)),r=await v(t);const l=r.docs.map(y=>q(y.ref,{myTurn:0}));await Promise.all(l)}},z=async()=>{a.value.length===0?h.warning("請選擇玩家"):D.value?(i.value=!0,await T(a.value),await V(a.value),S.value.attacked>0&&O(d,"players","name",S.value.name,"attacked",-1),b.value=!1,i.value=!1):(await T(a.value),await V(a.value),w.push({path:`${Q}/game/${m.value}`,query:{host:f.value?1:0,player:String(N.value)}}))};return G(()=>b.value,s=>{s===!0&&$()}),(s,e)=>{const t=k("n-select"),r=k("n-button"),o=k("n-card"),l=k("n-modal");return H(),L(l,{show:b.value,"onUpdate:show":e[2]||(e[2]=y=>b.value=y),"mask-closable":!!D.value},{default:C(()=>[x(o,{style:{width:"400px"},title:"選擇下一位玩家",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:C(()=>[x(r,{loading:i.value,size:"large",type:"primary",onClick:e[1]||(e[1]=y=>z())},{default:C(()=>[F("確認")]),_:1},8,["loading"])]),default:C(()=>[x(t,{value:a.value,"onUpdate:value":e[0]||(e[0]=y=>a.value=y),options:c.value},null,8,["value","options"])]),_:1})]),_:1},8,["show","mask-closable"])}}});export{Z as _,O as i,Y as s};
