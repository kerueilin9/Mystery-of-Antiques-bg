import{d as z,a as A,c as w,q as g,w as _,g as c,u as P}from"./firebaseConfig-B3bhHNjF.js";import{d as B,j as U,r as i,h as x,k as S,l as V,a as m,o as j,m as E,w as d,b as M,e as G,i as H,u as F}from"./index-q8fPHson.js";const J="/Mystery-of-Antiques-bg",O=B({__name:"SelectModal",props:{showModal:{},showModalModifiers:{},name:{},nameModifiers:{}},emits:["update:showModal","update:name"],setup(b){const T=U(),u=H(),D=F(),p=i(),n=i(""),f=i();f.value=u.params.roomId;const v=z(A,"rooms",f.value),q=i("");q.value=String(u.query.player);const C=x(()=>u.query.host==="1"),h=S(b,"showModal"),I=S(b,"name"),y=x(()=>!(C.value&&u.fullPath.includes("room"))),N=async()=>{try{const t=w(v,"players"),e=await c(t),a=[];e.forEach(l=>{const o=l.data();if(o.remain){const s={label:o.name,value:o.character};a.push(s)}}),p.value=a,console.log(p.value)}catch{}},k=async t=>{const e=w(v,"players");let a=g(e,_("character","==",t)),o=(await c(a)).docs.map(s=>P(s.ref,{remain:0}));await Promise.all(o)},R=async t=>{const e=w(v,"players");let a=g(e,_("character","==",t)),l=await c(a);const o=l.docs.map(s=>P(s.ref,{myTurn:1}));if(await Promise.all(o),y.value){a=g(e,_("name","==",q.value)),l=await c(a);const s=l.docs.map(r=>P(r.ref,{myTurn:0}));await Promise.all(s)}},$=async()=>{n.value.length===0?T.warning("請選擇玩家"):y.value?(await k(n.value),await R(n.value)):(await k(n.value),await R(n.value),D.push({path:`${J}/game/${f.value}`,query:{host:C.value?1:0,player:String(I.value)}}))};return V(()=>h.value,t=>{t===!0&&N()}),(t,e)=>{const a=m("n-select"),l=m("n-button"),o=m("n-card"),s=m("n-modal");return j(),E(s,{show:h.value,"onUpdate:show":e[2]||(e[2]=r=>h.value=r),"mask-closable":!!y.value},{default:d(()=>[M(o,{style:{width:"400px"},title:"選擇下一位玩家",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:d(()=>[M(l,{size:"large",type:"primary",onClick:e[1]||(e[1]=r=>$())},{default:d(()=>[G("確認")]),_:1})]),default:d(()=>[M(a,{value:n.value,"onUpdate:value":e[0]||(e[0]=r=>n.value=r),options:p.value},null,8,["value","options"])]),_:1})]),_:1},8,["show","mask-closable"])}}});export{O as _};
