import{d as W,o as f,c as Z,g as R,k as se,r as n,l as T,m as de,a as m,n as b,w as l,b as d,e as x,p as B,q as le,F as te,t as ue,j as re,u as ce,h as ve,s as me,f as fe}from"./index-CuIsaB5c.js";import{d as H,a as J,c as L,g as N,q as ne,w as oe,u as ie,b as ye,s as he}from"./firebaseConfig-BxjB4Upe.js";import{s as K,i as ge,_ as we}from"./SelectModal.vue_vue_type_script_setup_true_lang-B0ErMx07.js";const _e={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ke=R("path",{d:"M384 224v184a40 40 0 0 1-40 40H104a40 40 0 0 1-40-40V168a40 40 0 0 1 40-40h167.48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),be=R("path",{d:"M459.94 53.25a16.06 16.06 0 0 0-23.22-.56L424.35 65a8 8 0 0 0 0 11.31l11.34 11.32a8 8 0 0 0 11.34 0l12.06-12c6.1-6.09 6.67-16.01.85-22.38z",fill:"currentColor"},null,-1),Me=R("path",{d:"M399.34 90L218.82 270.2a9 9 0 0 0-2.31 3.93L208.16 299a3.91 3.91 0 0 0 4.86 4.86l24.85-8.35a9 9 0 0 0 3.93-2.31L422 112.66a9 9 0 0 0 0-12.66l-9.95-10a9 9 0 0 0-12.71 0z",fill:"currentColor"},null,-1),xe=[ke,be,Me],Re=W({name:"CreateOutline",render:function(z,C){return f(),Z("svg",_e,xe)}}),Ce={class:"flex justify-end mt-8"},De=W({__name:"CheckAntiquesModal",props:{showModal:{},showModalModifiers:{},currentRound:{},currentRoundModifiers:{},playerData:{},playerDataModifiers:{}},emits:["update:showModal","update:currentRound","update:playerData"],setup(U){const z=re();ce();const C=se(),D=n();D.value=z.params.roomId;const V=H(J,"rooms",D.value),$=T(U,"showModal"),r=T(U,"currentRound"),v=T(U,"playerData"),y=n(),t=n(null),i=n(""),M=n(!0),S=["JiYunfu","MedicineIsNot","ZhengGuoqu","LaoChaofeng"],F=async()=>{try{console.log(r.value);const c=L(V,`ReadomAnimalForRound${r.value}`),o=await N(c),e=[];o.forEach(s=>{const g=s.data(),u={name:g.name,value:g.value,view_value:g.view_value};e.push(u)}),console.log(e),y.value=e}catch{}},I=async()=>{let c=null;if(t.value.length===0||t.value===null)C.warning("請選擇至少一隻動物");else if(v.value.isCheckAble>r.value)C.warning("本輪已查看過，請勿作弊");else if(v.value.attacked>0)C.warning("你被藥不然偷襲了!!!",{closable:!0,duration:0}),M.value=!1,K(V,"players","name",v.value.name,"isCheckAble",r.value+1);else{const o=typeof t.value=="string"?[t.value]:t.value;c=y.value.filter(s=>o.some(g=>g===s.name));let e=[];S.includes(v.value.character)?c.forEach(s=>{e.push(`${s.name}是${s.value>=0?s.value?"真的":"假的":"什麼鬼"}`)}):c.forEach(s=>{e.push(`${s.name}是${s.view_value>=0&&v.value.inActiveRound!==r.value?s.view_value?"真的":"假的":"什麼鬼"}`)}),i.value=e.join(`
`),console.log(i.value),M.value=!1,K(V,"players","name",v.value.name,"isCheckAble",r.value+1)}},P=c=>{t.value=c};return de(()=>$.value,c=>{c===!0&&(F(),v.value.isCheckAble<=r.value?M.value=!0:M.value=!1)}),(c,o)=>{const e=m("n-radio"),s=m("n-space"),g=m("n-radio-group"),u=m("n-checkbox"),Q=m("n-gi"),X=m("n-grid"),ee=m("n-checkbox-group"),G=m("n-button"),O=m("n-card"),ae=m("n-modal");return f(),b(ae,{show:$.value,"onUpdate:show":o[3]||(o[3]=w=>$.value=w),"mask-closable":!0},{default:l(()=>[d(O,{style:{width:"400px"},title:"鑑定古董",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:l(()=>[R("div",Ce,[R("div",null,[d(G,{size:"large",onClick:o[1]||(o[1]=w=>$.value=!1)},{default:l(()=>[x("返回")]),_:1})]),R("div",null,[M.value?(f(),b(G,{key:0,size:"large",type:"primary",onClick:o[2]||(o[2]=w=>I())},{default:l(()=>[x("確認")]),_:1})):B("",!0)])])]),default:l(()=>[v.value.character!=="MakeAWish"?(f(),b(g,{key:0,value:t.value,"onUpdate:value":o[0]||(o[0]=w=>t.value=w),name:"radiogroup"},{default:l(()=>[d(s,null,{default:l(()=>[(f(!0),Z(te,null,le(y.value,w=>(f(),b(e,{key:w.name,value:w.name,label:w.name},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])):(f(),b(ee,{key:1,max:2,"onUpdate:value":P},{default:l(()=>[d(X,{"y-gap":8,cols:2},{default:l(()=>[(f(!0),Z(te,null,le(y.value,(w,p)=>(f(),b(Q,{key:p},{default:l(()=>[d(u,{value:w.name,label:w.name},null,8,["value","label"])]),_:2},1024))),128))]),_:1})]),_:1})),i.value.length!==0?(f(),b(O,{key:2,title:"鑑定結果"},{default:l(()=>[x(ue(i.value),1)]),_:1})):B("",!0)]),_:1})]),_:1},8,["show"])}}}),Ae={key:0},$e={key:1},Se={class:"flex justify-end mt-8"},qe=W({__name:"SkillModal",props:{showModal:{},showModalModifiers:{},currentRound:{},currentRoundModifiers:{},playerData:{},playerDataModifiers:{}},emits:["update:showModal","update:currentRound","update:playerData"],setup(U){const z=se(),C=re();ce();const D=n(),V=n(),$=n();$.value=C.params.roomId;const r=H(J,"rooms",$.value),v=T(U,"showModal"),y=T(U,"currentRound"),t=T(U,"playerData"),i=n(),M=n(!1),S=n(""),F=n(""),I=n(""),P=n(""),c=n(!1),o=n(!0),e=["MakeAWish","FangZhen","JiYunfu","KidoKana","HuangYanyan"],s=ve(()=>!(!M.value&&S.value.length===0&&F.value.length===0&&I.value.length===0));V.value=[{label:"435",value:"MedicineIsNot"}];const g=n([]),u=async()=>{try{const p=L(r,"players"),a=await N(p),_=[],A=[],k=[];a.forEach(j=>{const q=j.data();if(q.remain){const E={label:q.name,value:q.name};A.push(E)}else{const E={label:q.name,value:q.name};_.push(E)}const Y={label:q.name,value:q.character};k.push(Y)}),D.value=k,console.log(D.value),g.value=[{type:"group",label:"本輪已行動的玩家",key:"acted",children:_},{type:"group",label:"本輪還未行動的玩家",key:"pending",children:A}]}catch{}},Q=async()=>{try{console.log(y.value);const p=L(r,`ReadomAnimalForRound${y.value}`),a=await N(p),_=[];a.forEach(A=>{const k=A.data(),j={name:k.name,value:k.value,view_value:k.view_value};_.push(j)}),console.log(_),i.value=_}catch{}},X=async p=>{try{const a=H(r,`ReadomAnimalForRound${y.value}`,p),_=await ye(a);if(_.exists()){const A=_.data().view_value;A>=0&&await he(a,{view_value:A===1?0:1},{merge:!0})}else console.warn("無對應資料")}catch(a){console.error("老嘲諷技能問題: ",a)}},ee=async p=>{if(p)try{(await N(L(r,`ReadomAnimalForRound${y.value}`))).forEach(_=>{X(_.id)})}catch(a){console.error("老嘲諷技能問題: ",a)}},G=async p=>{try{const a=ne(L(r,`ReadomAnimalForRound${y.value}`),oe("name","==",p));let A=(await N(a)).docs.map(k=>{k.data().value===1?ie(k.ref,{value:-1,view_value:-1}):k.data().value===0&&ie(k.ref,{value:-2,view_value:-2})});await Promise.all(A)}catch{}},O=async p=>{ge(r,"players","name",p,"attacked",1)},ae=async p=>{P.value=`此玩家是${e.includes(p)?"好人":"壞人"}`},w=async()=>{if(t.value.isSkillAble>y.value)z.warning("本輪已使用過");else if(t.value.attacked>0)z.warning("你被藥不然偷襲了!!!",{closable:!0,duration:0}),o.value=!1,K(r,"players","name",t.value.name,"isSkillAble",y.value+1);else{switch(t.value.character){case"LaoChaofeng":c.value=!0,await ee(M.value),v.value=!1,c.value=!1;break;case"MedicineIsNot":c.value=!0,await O(S.value),v.value=!1,c.value=!1;break;case"ZhengGuoqu":c.value=!0,await G(F.value),v.value=!1,c.value=!1;break;case"FangZhen":c.value=!0,await ae(I.value),o.value=!1,c.value=!1;break}K(r,"players","name",t.value.name,"isSkillAble",y.value+1)}};return de(()=>v.value,p=>{p===!0&&(t.value.isSkillAble<=y.value?o.value=!0:o.value=!1),t.value.character==="ZhengGuoqu"&&Q(),(t.value.character==="FangZhen"||t.value.character==="MedicineIsNot")&&u()}),(p,a)=>{const _=m("n-checkbox"),A=m("n-radio"),k=m("n-space"),j=m("n-radio-group"),q=m("n-select"),Y=m("n-button"),E=m("n-card"),pe=m("n-modal");return f(),b(pe,{show:v.value,"onUpdate:show":a[6]||(a[6]=h=>v.value=h)},{default:l(()=>[d(E,{style:{width:"400px"},title:"使用技能",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:l(()=>[R("div",Se,[R("div",null,[d(Y,{size:"large",onClick:a[4]||(a[4]=h=>v.value=!1)},{default:l(()=>[x("返回")]),_:1})]),R("div",null,[o.value?(f(),b(Y,{key:0,size:"large",type:"primary",loading:c.value,disabled:!s.value,onClick:a[5]||(a[5]=h=>w())},{default:l(()=>[x("確認")]),_:1},8,["loading","disabled"])):B("",!0)])])]),default:l(()=>[t.value.character==="LaoChaofeng"?(f(),Z("div",Ae,[d(_,{checked:M.value,"onUpdate:checked":a[0]||(a[0]=h=>M.value=h)},{default:l(()=>[x(" 之後玩家看到的真假互換(同陣營和姬雲浮不適用) ")]),_:1},8,["checked"])])):t.value.character==="ZhengGuoqu"?(f(),Z("div",$e,[d(j,{value:F.value,"onUpdate:value":a[1]||(a[1]=h=>F.value=h),name:"radiogroup"},{default:l(()=>[d(k,null,{default:l(()=>[(f(!0),Z(te,null,le(i.value,h=>(f(),b(A,{key:h.name,value:h.name,label:h.name},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])])):t.value.character==="MedicineIsNot"?(f(),b(q,{key:2,value:S.value,"onUpdate:value":a[2]||(a[2]=h=>S.value=h),options:g.value},null,8,["value","options"])):t.value.character==="FangZhen"?(f(),b(q,{key:3,value:I.value,"onUpdate:value":a[3]||(a[3]=h=>I.value=h),options:D.value},null,8,["value","options"])):B("",!0),P.value.length!==0?(f(),b(E,{key:4,title:"鑑定結果"},{default:l(()=>[x(ue(P.value),1)]),_:1})):B("",!0)]),_:1})]),_:1},8,["show"])}}}),Ue={class:"w-10/12 max-w-sm mt-8 mx-auto text-center"},ze={class:"text-3xl"},Fe={class:"flex flex-col h-auto justify-around"},Ie={class:"flex flex-col items-center"},Ne=W({__name:"Game",setup(U){const z=re();ce();const C=se(),D=n();D.value=z.params.roomId;const V=H(J,"rooms",D.value),$=n();$.value=z.query.player,ve(()=>z.query.host==="1");const r=n(0);n(1);const v=n(!1),y=n(!1),t=n(!1),i=n(),M=n(""),S=async()=>{try{const o=ne(L(V,"players"),oe("name","==",$.value));return(await N(o)).docs[0].data()}catch{}},F=async()=>{try{const o=ne(L(J,"rooms"),oe("roomId","==",D.value));return(await N(o)).docs[0].data().currentRound}catch{}},I=async()=>{i.value=await S(),i.value.character==="FangZhen"?C.warning("你沒有鑑寶能力"):i.value.myTurn===1?(r.value=await F(),y.value=!0):C.warning("還沒有到你的回合")},P=async()=>{i.value=await S(),i.value.myTurn===1?(M.value=i.value.character,r.value=await F(),t.value=!0):C.warning("還沒有到你的回合")},c=async()=>{i.value=await S(),i.value.myTurn===1?v.value=!0:C.warning("還沒有到你的回合")};return me(async()=>{}),(o,e)=>{const s=m("n-button"),g=m("n-icon");return f(),Z("div",Ue,[R("p",ze,"房號："+ue(D.value),1),R("div",Fe,[d(s,{class:"text-4xl h-14 mt-8",type:"primary",size:"large",onClick:e[0]||(e[0]=()=>{})},{default:l(()=>[x("查看隊友")]),_:1}),d(s,{class:"text-4xl h-14 mt-8",type:"primary",size:"large",onClick:e[1]||(e[1]=u=>I())},{default:l(()=>[x("鑑定古董")]),_:1}),d(s,{class:"text-4xl h-14 mt-8",type:"primary",size:"large",onClick:e[2]||(e[2]=u=>P())},{default:l(()=>[x("使用技能")]),_:1}),d(s,{class:"text-4xl h-14 mt-8",type:"primary",size:"large",onClick:e[3]||(e[3]=u=>c())},{default:l(()=>[x("選擇下一位玩家")]),_:1}),d(s,{class:"text-4xl h-14 mt-8",type:"warning",size:"large",onClick:e[4]||(e[4]=()=>{})},{default:l(()=>[x("投票")]),_:1})]),R("div",Ie,[d(s,{onClick:e[5]||(e[5]=()=>{}),circle:"",class:"w-20 h-20 absolute bottom-20",dashed:"",type:"info"},{icon:l(()=>[d(g,{class:"text-6xl"},{default:l(()=>[d(fe(Re))]),_:1})]),_:1})]),d(De,{showModal:y.value,"onUpdate:showModal":e[6]||(e[6]=u=>y.value=u),currentRound:r.value,"onUpdate:currentRound":e[7]||(e[7]=u=>r.value=u),playerData:i.value,"onUpdate:playerData":e[8]||(e[8]=u=>i.value=u)},null,8,["showModal","currentRound","playerData"]),d(qe,{showModal:t.value,"onUpdate:showModal":e[9]||(e[9]=u=>t.value=u),currentRound:r.value,"onUpdate:currentRound":e[10]||(e[10]=u=>r.value=u),playerData:i.value,"onUpdate:playerData":e[11]||(e[11]=u=>i.value=u)},null,8,["showModal","currentRound","playerData"]),d(we,{showModal:v.value,"onUpdate:showModal":e[12]||(e[12]=u=>v.value=u),playerData:i.value,"onUpdate:playerData":e[13]||(e[13]=u=>i.value=u)},null,8,["showModal","playerData"])])}}});export{Ne as default};
