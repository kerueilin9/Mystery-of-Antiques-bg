import{d as A,h as E,r as o,i as T,j as z,a as y,o as G,c as W,g as Z,t as F,b as d,w as m,e as K,l as O,u as Q}from"./index-BQKzonqr.js";import{d as U,a as q,c as p,g as v,q as C,w as x,r as H,b as J,e as X,o as Y,i as ee,j as ae}from"./firebaseConfig-BR434puB.js";import{a as oe,c}from"./setFirebaseData-DednQhw6.js";const te={class:"w-10/12 max-w-sm mt-8 mx-auto text-center"},se={class:"text-3xl"},ne="/Mystery-of-Antiques-bg",ie=A({__name:"Vote",setup(re){const i=O(),S=Q(),D=E(),a=o();a.value=i.params.roomId;const f=U(q,"rooms",a.value),h=o();h.value=i.query.player;const g=T(()=>i.query.host==="1"),V=o(!1),w=o();o(4);const u=o(""),_=o(!0);o(1);const b=o();o("");const k=async()=>{try{const t=p(f,"players"),e=await v(t),s=[];e.forEach(r=>{const n=r.data(),l={label:n.name,value:n.character};s.push(l)}),w.value=s}catch{}},P=async t=>{try{const e=C(p(f,"players"),x("name","==",t));return(await v(e)).docs[0].data()}catch(e){console.log(e)}},I=async()=>{u.value==="MakeAWish"?await c(a.value,"score",-2):await c(a.value,"score",2)},R=async()=>{u.value==="FangZhen"?await c(a.value,"score",-1):await c(a.value,"score",1)},B=async()=>{u.value==="LaoChaofeng"&&await c(a.value,"voteLaoChaofeng",1)},L=async()=>{if(u.value==="")D.warning("請選擇玩家");else{switch(_.value=!1,b.value.character){case"LaoChaofeng":await I();break;case"MedicineIsNot":await R();break;case"ZhengGuoqu":break;default:await B();break}await oe(a.value,"votedPlayerCount",1)}},M=async()=>{const t=C(p(q,"rooms"),x("roomId","==",a.value));(await v(t)).docs[0].data().voteLaoChaofeng>=3&&g.value?await c(a.value,"score",1):g.value&&await c(a.value,"score",-1),S.push({path:`${ne}/endGame/${a.value}`,query:{...i.query}})},j=async t=>{try{const e=H(J,"rooms"),s=X(e,Y("roomId"),ee(t));ae(s,async r=>{if(r.exists()){const n=r.val(),l=Object.keys(n)[0],N=n[l].playerCount||0,$=n[l].votedPlayerCount||0;N===$&&await M()}else console.log("roomId not found")})}catch(e){console.error("Error querying roomId",e)}};return z(async()=>{await j(a.value),await k(),b.value=await P(String(h.value))}),(t,e)=>{const s=y("n-card"),r=y("n-select"),n=y("n-button");return G(),W("div",te,[Z("p",se,"房號："+F(a.value),1),d(s,{title:"前三輪投票結果",class:"flex flex-col justify-around h-2/5 mt-8"}),d(s,{title:"鑑人投票",class:"flex flex-col justify-around mt-8",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:m(()=>[d(n,{loading:V.value,disabled:!_.value,size:"large",type:"primary",onClick:e[1]||(e[1]=l=>L())},{default:m(()=>[K("確認")]),_:1},8,["loading","disabled"])]),default:m(()=>[d(r,{value:u.value,"onUpdate:value":e[0]||(e[0]=l=>u.value=l),options:w.value},null,8,["value","options"])]),_:1})])}}});export{ie as default};
