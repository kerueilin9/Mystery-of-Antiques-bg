import{d as K,j as O,r as t,k as E,l as oe,a as u,o as f,m as S,w as n,b as c,g as j,e as $,c as L,n as B,F as J,t as te,p as Q,i as X,u as ee,h as W,q as ne}from"./index-q8fPHson.js";import{d as P,a as T,c as z,g as F,q as Y,w as H,u as ae,b as le,s as se}from"./firebaseConfig-B3bhHNjF.js";import{_ as ue}from"./SelectModal.vue_vue_type_script_setup_true_lang-BxJLqTRU.js";const re={class:"flex justify-end"},ce=K({__name:"CheckAntiquesModal",props:{showModal:{},showModalModifiers:{},currentRound:{},currentRoundModifiers:{},character:{},characterModifiers:{}},emits:["update:showModal","update:currentRound","update:character"],setup(A){const M=X();ee();const D=O(),b=t();b.value=M.params.roomId;const q=P(T,"rooms",b.value),U=E(A,"showModal"),I=E(A,"currentRound"),R=E(A,"character"),d=t(),s=t(null),_=t(""),i=t(!0),g=["JiYunfu","MedicineIsNot","ZhengGuoqu","LaoChaofeng"],x=async()=>{try{console.log(I.value);const p=z(q,`ReadomAnimalForRound${I.value}`),y=await F(p),l=[];y.forEach(e=>{const r=e.data(),a={name:r.name,value:r.value,view_value:r.view_value};l.push(a)}),console.log(l),d.value=l}catch{}},h=async()=>{let p=null;if(s.value.length!==0&&s.value!==null&&i.value){const y=typeof s.value=="string"?[s.value]:s.value;p=d.value.filter(e=>y.some(r=>r===e.name));let l=[];g.includes(R.value)?p.forEach(e=>{l.push(`${e.name}是${e.value>=0?e.value?"真的":"假的":"什麼鬼"}`)}):p.forEach(e=>{l.push(`${e.name}是${e.view_value>=0?e.view_value?"真的":"假的":"什麼鬼"}`)}),_.value=l.join(`
`),console.log(_.value),i.value=!1}else D.warning("無法查看")},N=p=>{s.value=p};return oe(()=>U.value,p=>{p===!0&&x()}),(p,y)=>{const l=u("n-radio"),e=u("n-space"),r=u("n-radio-group"),a=u("n-checkbox"),o=u("n-gi"),v=u("n-grid"),k=u("n-checkbox-group"),m=u("n-button"),V=u("n-card"),G=u("n-modal");return f(),S(G,{show:U.value,"onUpdate:show":y[2]||(y[2]=w=>U.value=w),"mask-closable":!0},{default:n(()=>[c(V,{style:{width:"400px"},title:"鑑定古董",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:n(()=>[j("div",re,[c(m,{size:"large",type:"primary",onClick:y[1]||(y[1]=w=>h())},{default:n(()=>[$("確認")]),_:1})])]),default:n(()=>[R.value!=="MakeAWish"?(f(),S(r,{key:0,value:s.value,"onUpdate:value":y[0]||(y[0]=w=>s.value=w),name:"radiogroup"},{default:n(()=>[c(e,null,{default:n(()=>[(f(!0),L(J,null,B(d.value,w=>(f(),S(l,{key:w.name,value:w.name,label:w.name},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])):(f(),S(k,{key:1,max:2,"onUpdate:value":N},{default:n(()=>[c(v,{"y-gap":8,cols:2},{default:n(()=>[(f(!0),L(J,null,B(d.value,(w,Z)=>(f(),S(o,{key:Z},{default:n(()=>[c(a,{value:w.name,label:w.name},null,8,["value","label"])]),_:2},1024))),128))]),_:1})]),_:1})),_.value.length!==0?(f(),S(V,{key:2,title:"鑑定結果"},{default:n(()=>[$(te(_.value),1)]),_:1})):Q("",!0)]),_:1})]),_:1},8,["show"])}}}),de={key:0},ie={key:1},ve=K({__name:"SkillModal",props:{showModal:{},showModalModifiers:{},currentRound:{},currentRoundModifiers:{},character:{},characterModifiers:{}},emits:["update:showModal","update:currentRound","update:character"],setup(A){O();const M=X();ee();const D=t();t("");const b=t();b.value=M.params.roomId;const q=P(T,"rooms",b.value),U=t("");U.value=String(M.query.player);const I=W(()=>M.query.host==="1"),R=W(()=>!(I.value&&M.fullPath.includes("room"))),d=E(A,"showModal"),s=E(A,"currentRound"),_=E(A,"character"),i=t(!1);t(null),t("");const g=t(),x=t(""),h=t(!1),N=async()=>{try{const a=z(q,"players"),o=await F(a),v=[];o.forEach(k=>{const m=k.data(),V={label:m.name,value:m.character};v.push(V)}),D.value=v,console.log(D.value)}catch{}},p=async()=>{try{console.log(s.value);const a=z(q,`ReadomAnimalForRound${s.value}`),o=await F(a),v=[];o.forEach(k=>{const m=k.data(),V={name:m.name,value:m.value,view_value:m.view_value};v.push(V)}),console.log(v),g.value=v}catch{}},y=async a=>{try{const o=P(q,`ReadomAnimalForRound${s.value}`,a),v=await le(o);if(v.exists()){const k=v.data().view_value;k>=0&&await se(o,{view_value:k===1?0:1},{merge:!0})}else console.warn("無對應資料")}catch(o){console.error("老嘲諷技能問題: ",o)}},l=async a=>{if(a)try{(await F(z(q,`ReadomAnimalForRound${s.value}`))).forEach(v=>{y(v.id)})}catch(o){console.error("老嘲諷技能問題: ",o)}},e=async a=>{try{const o=Y(z(q,`ReadomAnimalForRound${s.value}`),H("name","==",a));let k=(await F(o)).docs.map(m=>{m.data().value===1?ae(m.ref,{value:-1,view_value:-1}):m.data().value===0&&ae(m.ref,{value:-2,view_value:-2})});await Promise.all(k)}catch{}},r=async()=>{switch(_.value){case"LaoChaofeng":h.value=!0,await l(i.value),d.value=!1,h.value=!1;break;case"MedicineIsNot":h.value=!0,await e(x.value),d.value=!1,h.value=!1;break;case"ZhengGuoqu":h.value=!0,await e(x.value),d.value=!1,h.value=!1;break;case"FangZhen":h.value=!0,await l(i.value),d.value=!1,h.value=!1;break}};return oe(()=>d.value,a=>{a===!0&&N(),_.value==="ZhengGuoqu"&&p()}),(a,o)=>{const v=u("n-checkbox"),k=u("n-radio"),m=u("n-space"),V=u("n-radio-group"),G=u("n-button"),w=u("n-card"),Z=u("n-modal");return f(),S(Z,{show:d.value,"onUpdate:show":o[3]||(o[3]=C=>d.value=C),"mask-closable":!!R.value},{default:n(()=>[c(w,{style:{width:"400px"},title:"使用技能",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:n(()=>[c(G,{size:"large",type:"primary",loading:h.value,onClick:o[2]||(o[2]=C=>r())},{default:n(()=>[$("確認")]),_:1},8,["loading"])]),default:n(()=>[_.value==="LaoChaofeng"?(f(),L("div",de,[c(v,{checked:i.value,"onUpdate:checked":o[0]||(o[0]=C=>i.value=C)},{default:n(()=>[$(" 之後玩家看到的真假互換(同陣營和姬雲浮不適用) ")]),_:1},8,["checked"])])):_.value==="ZhengGuoqu"?(f(),L("div",ie,[c(V,{value:x.value,"onUpdate:value":o[1]||(o[1]=C=>x.value=C),name:"radiogroup"},{default:n(()=>[c(m,null,{default:n(()=>[(f(!0),L(J,null,B(g.value,C=>(f(),S(k,{key:C.name,value:C.name,label:C.name},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])])):Q("",!0)]),_:1})]),_:1},8,["show","mask-closable"])}}}),me={class:"w-10/12 max-w-sm mt-8 mx-auto text-center"},pe={class:"text-3xl"},fe={class:"flex flex-col h-96 justify-around"},we=K({__name:"Game",setup(A){const M=X();ee();const D=O(),b=t();b.value=M.params.roomId;const q=P(T,"rooms",b.value),U=t();U.value=M.query.player;const I=W(()=>M.query.host==="1"),R=t(0);t(1);const d=t(!1),s=t(!1),_=t(!1),i=t(),g=t(""),x=async()=>{try{const l=Y(z(q,"players"),H("name","==",U.value));return(await F(l)).docs[0].data()}catch{}},h=async()=>{try{const l=Y(z(T,"rooms"),H("roomId","==",b.value));return(await F(l)).docs[0].data().currentRound}catch{}},N=async()=>{i.value=await x(),i.value.myTurn===1?(g.value=i.value.character,console.log(g.value),R.value=await h(),s.value=!0):D.warning("還沒有到你的回合")},p=async()=>{i.value=await x(),i.value.myTurn===1?(g.value=i.value.character,R.value=await h(),_.value=!0):D.warning("還沒有到你的回合")},y=async()=>{i.value=await x(),i.value.myTurn===1?d.value=!0:D.warning("還沒有到你的回合")};return ne(async()=>{}),(l,e)=>{const r=u("n-button");return f(),L("div",me,[j("p",pe,"房號："+te(b.value),1),j("div",fe,[c(r,{class:"text-4xl h-14",type:"primary",size:"large",onClick:e[0]||(e[0]=()=>{})},{default:n(()=>[$("查看隊友")]),_:1}),c(r,{class:"text-4xl h-14",type:"primary",size:"large",onClick:e[1]||(e[1]=a=>N())},{default:n(()=>[$("鑑定古董")]),_:1}),c(r,{class:"text-4xl h-14",type:"primary",size:"large",onClick:e[2]||(e[2]=a=>p())},{default:n(()=>[$("使用技能")]),_:1}),c(r,{class:"text-4xl h-14",type:"primary",size:"large",onClick:e[3]||(e[3]=a=>y())},{default:n(()=>[$("選擇下一位玩家")]),_:1}),I.value?(f(),S(r,{key:0,class:"text-4xl h-14",type:"primary",size:"large",onClick:e[4]||(e[4]=()=>{})},{default:n(()=>[$("投票")]),_:1})):Q("",!0)]),c(ce,{showModal:s.value,"onUpdate:showModal":e[5]||(e[5]=a=>s.value=a),currentRound:R.value,"onUpdate:currentRound":e[6]||(e[6]=a=>R.value=a),character:g.value,"onUpdate:character":e[7]||(e[7]=a=>g.value=a)},null,8,["showModal","currentRound","character"]),c(ve,{showModal:_.value,"onUpdate:showModal":e[8]||(e[8]=a=>_.value=a),currentRound:R.value,"onUpdate:currentRound":e[9]||(e[9]=a=>R.value=a),character:g.value,"onUpdate:character":e[10]||(e[10]=a=>g.value=a)},null,8,["showModal","currentRound","character"]),c(ue,{showModal:d.value,"onUpdate:showModal":e[11]||(e[11]=a=>d.value=a)},null,8,["showModal"])])}}});export{we as default};
