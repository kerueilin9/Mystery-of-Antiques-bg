import{d as j,a as A,c as M,q as P,w as x,g as p,u as b}from"./firebaseConfig-BR434puB.js";import{d as U,f as E,r as c,l as S,g as k,h as G,a as f,o as H,i as L,w as i,b as v,j as F,e as B,p as J,u as K}from"./index-Kfy5H1H5.js";import{i as O}from"./setFirebaseData-DDiyQXTP.js";const Q={class:"flex justify-end mt-8"},W="/Mystery-of-Antiques-bg",ee=U({__name:"SelectModal",props:{showModal:{},showModalModifiers:{},playerData:{},playerDataModifiers:{},name:{},nameModifiers:{}},emits:["update:showModal","update:playerData","update:name"],setup(y){const N=E(),d=J(),T=K(),h=c(),t=c(""),w=c(!1),g=c();g.value=d.params.roomId;const m=j(A,"rooms",g.value),q=c("");q.value=String(d.query.player);const C=S(()=>d.query.host==="1"),u=k(y,"showModal"),D=k(y,"playerData"),V=k(y,"name"),_=S(()=>!(C.value&&d.fullPath.includes("room"))),$=async()=>{try{const s=M(m,"players"),e=await p(s),a=[];e.forEach(o=>{const l=o.data();if(l.remain){const n={label:l.name,value:l.character};a.push(n)}}),h.value=a,console.log(h.value)}catch{}},z=async s=>{const e=M(m,"players");let a=P(e,x("character","==",s)),l=(await p(a)).docs.map(n=>b(n.ref,{remain:0}));await Promise.all(l)},R=async s=>{const e=M(m,"players");let a=P(e,x("character","==",s)),o=await p(a);const l=o.docs.map(n=>b(n.ref,{myTurn:1}));if(await Promise.all(l),_.value){a=P(e,x("name","==",q.value)),o=await p(a);const n=o.docs.map(r=>b(r.ref,{myTurn:0}));await Promise.all(n)}},I=async()=>{t.value===null||t.value.trim()===""?N.warning("請選擇玩家"):_.value?(w.value=!0,await z(t.value),await R(t.value),D.value.attacked>0&&O(m,"players","name",D.value.name,"attacked",-1),u.value=!1,w.value=!1):(await z(t.value),await R(t.value),T.push({path:`${W}/game/${g.value}`,query:{host:C.value?1:0,player:String(V.value)}}))};return G(()=>u.value,s=>{s===!0&&($(),t.value=null)}),(s,e)=>{const a=f("n-select"),o=f("n-button"),l=f("n-card"),n=f("n-modal");return H(),L(n,{show:u.value,"onUpdate:show":e[3]||(e[3]=r=>u.value=r),"mask-closable":!!_.value},{default:i(()=>[v(l,{class:"max-w-90 w-96 font-style-Bakudai","header-style":"font-size: 28px",title:"選擇下一位玩家",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:i(()=>[F("div",Q,[v(o,{class:"text-xl",size:"large",onClick:e[1]||(e[1]=r=>u.value=!1)},{default:i(()=>[B("返回")]),_:1}),v(o,{class:"text-xl",loading:w.value,size:"large",type:"primary",onClick:e[2]||(e[2]=r=>I())},{default:i(()=>[B("確認")]),_:1},8,["loading"])])]),default:i(()=>[v(a,{size:"large",class:"custom-select-font-size-game",value:t.value,"onUpdate:value":e[0]||(e[0]=r=>t.value=r),options:h.value},null,8,["value","options"])]),_:1})]),_:1},8,["show","mask-closable"])}}});export{ee as _};
