import{d as ne,k as se,r as t,l as T,m as de,a as v,o as d,n as b,w as o,b as y,g as z,e as M,p as L,c as j,q as ae,F as le,t as ue,j as re,u as ce,h as ve,s as me}from"./index-CrkAOP7J.js";import{d as W,a as H,c as N,g as Z,q as te,w as oe,u as ie,b as ye,s as fe}from"./firebaseConfig-yf3y-t-J.js";import{i as B,_ as he}from"./SelectModal.vue_vue_type_script_setup_true_lang-_rjwVnLm.js";const ge={class:"flex justify-end mt-8"},we=ne({__name:"CheckAntiquesModal",props:{showModal:{},showModalModifiers:{},currentRound:{},currentRoundModifiers:{},playerData:{},playerDataModifiers:{}},emits:["update:showModal","update:currentRound","update:playerData"],setup(F){const I=re();ce();const D=se(),R=t();R.value=I.params.roomId;const P=W(H,"rooms",R.value),A=T(F,"showModal"),f=T(F,"currentRound"),s=T(F,"playerData"),h=t(),n=t(null),x=t(""),u=t(!0),S=["JiYunfu","MedicineIsNot","ZhengGuoqu","LaoChaofeng"],$=async()=>{try{console.log(f.value);const r=N(P,`ReadomAnimalForRound${f.value}`),c=await Z(r),p=[];c.forEach(e=>{const m=e.data(),l={name:m.name,value:m.value,view_value:m.view_value};p.push(l)}),console.log(p),h.value=p}catch{}},U=async()=>{let r=null;if(n.value.length===0||n.value===null)D.warning("請選擇至少一隻動物");else if(s.value.isCheckAble>f.value)D.warning("本輪已查看過，請勿作弊");else if(s.value.attacked>0)D.warning("你被藥不然偷襲了!!!",{closable:!0,duration:0}),u.value=!1,B(P,"players","name",s.value.name,"isCheckAble",1);else{const c=typeof n.value=="string"?[n.value]:n.value;r=h.value.filter(e=>c.some(m=>m===e.name));let p=[];S.includes(s.value.character)?r.forEach(e=>{p.push(`${e.name}是${e.value>=0?e.value?"真的":"假的":"什麼鬼"}`)}):r.forEach(e=>{p.push(`${e.name}是${e.view_value>=0&&s.value.inActiveRound!==f.value?e.view_value?"真的":"假的":"什麼鬼"}`)}),x.value=p.join(`
`),console.log(x.value),u.value=!1,B(P,"players","name",s.value.name,"isCheckAble",1)}},V=r=>{n.value=r};return de(()=>A.value,r=>{r===!0&&($(),s.value.isCheckAble<=f.value?u.value=!0:u.value=!1)}),(r,c)=>{const p=v("n-radio"),e=v("n-space"),m=v("n-radio-group"),l=v("n-checkbox"),O=v("n-gi"),Q=v("n-grid"),X=v("n-checkbox-group"),Y=v("n-button"),J=v("n-card"),ee=v("n-modal");return d(),b(ee,{show:A.value,"onUpdate:show":c[3]||(c[3]=w=>A.value=w),"mask-closable":!0},{default:o(()=>[y(J,{style:{width:"400px"},title:"鑑定古董",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:o(()=>[z("div",ge,[z("div",null,[y(Y,{size:"large",onClick:c[1]||(c[1]=w=>A.value=!1)},{default:o(()=>[M("返回")]),_:1})]),z("div",null,[u.value?(d(),b(Y,{key:0,size:"large",type:"primary",onClick:c[2]||(c[2]=w=>U())},{default:o(()=>[M("確認")]),_:1})):L("",!0)])])]),default:o(()=>[s.value.character!=="MakeAWish"?(d(),b(m,{key:0,value:n.value,"onUpdate:value":c[0]||(c[0]=w=>n.value=w),name:"radiogroup"},{default:o(()=>[y(e,null,{default:o(()=>[(d(!0),j(le,null,ae(h.value,w=>(d(),b(p,{key:w.name,value:w.name,label:w.name},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])):(d(),b(X,{key:1,max:2,"onUpdate:value":V},{default:o(()=>[y(Q,{"y-gap":8,cols:2},{default:o(()=>[(d(!0),j(le,null,ae(h.value,(w,i)=>(d(),b(O,{key:i},{default:o(()=>[y(l,{value:w.name,label:w.name},null,8,["value","label"])]),_:2},1024))),128))]),_:1})]),_:1})),x.value.length!==0?(d(),b(J,{key:2,title:"鑑定結果"},{default:o(()=>[M(ue(x.value),1)]),_:1})):L("",!0)]),_:1})]),_:1},8,["show"])}}}),_e={key:0},ke={key:1},be={class:"flex justify-end mt-8"},Me=ne({__name:"SkillModal",props:{showModal:{},showModalModifiers:{},currentRound:{},currentRoundModifiers:{},playerData:{},playerDataModifiers:{}},emits:["update:showModal","update:currentRound","update:playerData"],setup(F){const I=se(),D=re();ce();const R=t(),P=t(),A=t();A.value=D.params.roomId;const f=W(H,"rooms",A.value),s=T(F,"showModal"),h=T(F,"currentRound"),n=T(F,"playerData"),x=t(),u=t(!1),S=t(""),$=t(""),U=t(""),V=t(""),r=t(!1),c=t(!0),p=["MakeAWish","FangZhen","JiYunfu","KidoKana","HuangYanyan"],e=ve(()=>!(!u.value&&S.value.length===0&&$.value.length===0&&U.value.length===0));P.value=[{label:"435",value:"MedicineIsNot"}];const m=t([]),l=async()=>{try{const i=N(f,"players"),a=await Z(i),_=[],C=[],k=[];a.forEach(G=>{const q=G.data();if(q.remain){const E={label:q.name,value:q.name};C.push(E)}else{const E={label:q.name,value:q.name};_.push(E)}const K={label:q.name,value:q.character};k.push(K)}),R.value=k,console.log(R.value),m.value=[{type:"group",label:"本輪已行動的玩家",key:"acted",children:_},{type:"group",label:"本輪還未行動的玩家",key:"pending",children:C}]}catch{}},O=async()=>{try{console.log(h.value);const i=N(f,`ReadomAnimalForRound${h.value}`),a=await Z(i),_=[];a.forEach(C=>{const k=C.data(),G={name:k.name,value:k.value,view_value:k.view_value};_.push(G)}),console.log(_),x.value=_}catch{}},Q=async i=>{try{const a=W(f,`ReadomAnimalForRound${h.value}`,i),_=await ye(a);if(_.exists()){const C=_.data().view_value;C>=0&&await fe(a,{view_value:C===1?0:1},{merge:!0})}else console.warn("無對應資料")}catch(a){console.error("老嘲諷技能問題: ",a)}},X=async i=>{if(i)try{(await Z(N(f,`ReadomAnimalForRound${h.value}`))).forEach(_=>{Q(_.id)})}catch(a){console.error("老嘲諷技能問題: ",a)}},Y=async i=>{try{const a=te(N(f,`ReadomAnimalForRound${h.value}`),oe("name","==",i));let C=(await Z(a)).docs.map(k=>{k.data().value===1?ie(k.ref,{value:-1,view_value:-1}):k.data().value===0&&ie(k.ref,{value:-2,view_value:-2})});await Promise.all(C)}catch{}},J=async i=>{B(f,"players","name",i,"attacked",1)},ee=async i=>{V.value=`此玩家是${p.includes(i)?"好人":"壞人"}`},w=async()=>{if(n.value.isSkillAble>h.value)I.warning("本輪已使用過");else if(n.value.attacked>0)I.warning("你被藥不然偷襲了!!!",{closable:!0,duration:0}),c.value=!1,B(f,"players","name",n.value.name,"isSkillAble",1);else{switch(n.value.character){case"LaoChaofeng":r.value=!0,await X(u.value),s.value=!1,r.value=!1;break;case"MedicineIsNot":r.value=!0,await J(S.value),s.value=!1,r.value=!1;break;case"ZhengGuoqu":r.value=!0,await Y($.value),s.value=!1,r.value=!1;break;case"FangZhen":r.value=!0,await ee(U.value),c.value=!1,r.value=!1;break}B(f,"players","name",n.value.name,"isSkillAble",1)}};return de(()=>s.value,i=>{i===!0&&(l(),n.value.isSkillAble<=h.value?c.value=!0:c.value=!1),n.value.character==="ZhengGuoqu"&&O()}),(i,a)=>{const _=v("n-checkbox"),C=v("n-radio"),k=v("n-space"),G=v("n-radio-group"),q=v("n-select"),K=v("n-button"),E=v("n-card"),pe=v("n-modal");return d(),b(pe,{show:s.value,"onUpdate:show":a[6]||(a[6]=g=>s.value=g)},{default:o(()=>[y(E,{style:{width:"400px"},title:"使用技能",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:o(()=>[z("div",be,[z("div",null,[y(K,{size:"large",onClick:a[4]||(a[4]=g=>s.value=!1)},{default:o(()=>[M("返回")]),_:1})]),z("div",null,[c.value?(d(),b(K,{key:0,size:"large",type:"primary",loading:r.value,disabled:!e.value,onClick:a[5]||(a[5]=g=>w())},{default:o(()=>[M("確認")]),_:1},8,["loading","disabled"])):L("",!0)])])]),default:o(()=>[n.value.character==="LaoChaofeng"?(d(),j("div",_e,[y(_,{checked:u.value,"onUpdate:checked":a[0]||(a[0]=g=>u.value=g)},{default:o(()=>[M(" 之後玩家看到的真假互換(同陣營和姬雲浮不適用) ")]),_:1},8,["checked"])])):n.value.character==="ZhengGuoqu"?(d(),j("div",ke,[y(G,{value:$.value,"onUpdate:value":a[1]||(a[1]=g=>$.value=g),name:"radiogroup"},{default:o(()=>[y(k,null,{default:o(()=>[(d(!0),j(le,null,ae(x.value,g=>(d(),b(C,{key:g.name,value:g.name,label:g.name},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])])):n.value.character==="MedicineIsNot"?(d(),b(q,{key:2,value:S.value,"onUpdate:value":a[2]||(a[2]=g=>S.value=g),options:m.value},null,8,["value","options"])):n.value.character==="FangZhen"?(d(),b(q,{key:3,value:U.value,"onUpdate:value":a[3]||(a[3]=g=>U.value=g),options:R.value},null,8,["value","options"])):L("",!0),V.value.length!==0?(d(),b(E,{key:4,title:"鑑定結果"},{default:o(()=>[M(ue(V.value),1)]),_:1})):L("",!0)]),_:1})]),_:1},8,["show"])}}}),Re={class:"w-10/12 max-w-sm mt-8 mx-auto text-center"},xe={class:"text-3xl"},Ce={class:"flex flex-col h-96 justify-around"},$e=ne({__name:"Game",setup(F){const I=re();ce();const D=se(),R=t();R.value=I.params.roomId;const P=W(H,"rooms",R.value),A=t();A.value=I.query.player;const f=ve(()=>I.query.host==="1"),s=t(0);t(1);const h=t(!1),n=t(!1),x=t(!1),u=t(),S=t(""),$=async()=>{try{const p=te(N(P,"players"),oe("name","==",A.value));return(await Z(p)).docs[0].data()}catch{}},U=async()=>{try{const p=te(N(H,"rooms"),oe("roomId","==",R.value));return(await Z(p)).docs[0].data().currentRound}catch{}},V=async()=>{u.value=await $(),u.value.character==="FangZhen"?D.warning("你沒有鑑寶能力"):u.value.myTurn===1?(s.value=await U(),n.value=!0):D.warning("還沒有到你的回合")},r=async()=>{u.value=await $(),u.value.myTurn===1?(S.value=u.value.character,s.value=await U(),x.value=!0):D.warning("還沒有到你的回合")},c=async()=>{u.value=await $(),u.value.myTurn===1?h.value=!0:D.warning("還沒有到你的回合")};return me(async()=>{}),(p,e)=>{const m=v("n-button");return d(),j("div",Re,[z("p",xe,"房號："+ue(R.value),1),z("div",Ce,[y(m,{class:"text-4xl h-14",type:"primary",size:"large",onClick:e[0]||(e[0]=()=>{})},{default:o(()=>[M("查看隊友")]),_:1}),y(m,{class:"text-4xl h-14",type:"primary",size:"large",onClick:e[1]||(e[1]=l=>V())},{default:o(()=>[M("鑑定古董")]),_:1}),y(m,{class:"text-4xl h-14",type:"primary",size:"large",onClick:e[2]||(e[2]=l=>r())},{default:o(()=>[M("使用技能")]),_:1}),y(m,{class:"text-4xl h-14",type:"primary",size:"large",onClick:e[3]||(e[3]=l=>c())},{default:o(()=>[M("選擇下一位玩家")]),_:1}),f.value?(d(),b(m,{key:0,class:"text-4xl h-14",type:"primary",size:"large",onClick:e[4]||(e[4]=()=>{})},{default:o(()=>[M("投票")]),_:1})):L("",!0)]),y(we,{showModal:n.value,"onUpdate:showModal":e[5]||(e[5]=l=>n.value=l),currentRound:s.value,"onUpdate:currentRound":e[6]||(e[6]=l=>s.value=l),playerData:u.value,"onUpdate:playerData":e[7]||(e[7]=l=>u.value=l)},null,8,["showModal","currentRound","playerData"]),y(Me,{showModal:x.value,"onUpdate:showModal":e[8]||(e[8]=l=>x.value=l),currentRound:s.value,"onUpdate:currentRound":e[9]||(e[9]=l=>s.value=l),playerData:u.value,"onUpdate:playerData":e[10]||(e[10]=l=>u.value=l),character:S.value,"onUpdate:character":e[11]||(e[11]=l=>S.value=l)},null,8,["showModal","currentRound","playerData","character"]),y(he,{showModal:h.value,"onUpdate:showModal":e[12]||(e[12]=l=>h.value=l)},null,8,["showModal"])])}}});export{$e as default};
