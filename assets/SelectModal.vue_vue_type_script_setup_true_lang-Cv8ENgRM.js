import{d as A,a as B,c as M,q as P,w as _,g as d,u as b}from"./firebaseConfig-BR434puB.js";import{d as U,h as E,r as u,i as T,m as q,n as G,a as p,o as H,p as L,w as f,b as D,e as j,l as F,u as J}from"./index-BQKzonqr.js";import{i as K}from"./setFirebaseData-DednQhw6.js";const O="/Mystery-of-Antiques-bg",Y=U({__name:"SelectModal",props:{showModal:{},showModalModifiers:{},playerData:{},playerDataModifiers:{},name:{},nameModifiers:{}},emits:["update:showModal","update:playerData","update:name"],setup(v){const I=E(),c=F(),N=J(),y=u(),l=u(""),h=u(!1),w=u();w.value=c.params.roomId;const i=A(B,"rooms",w.value),k=u("");k.value=String(c.query.player);const C=T(()=>c.query.host==="1"),m=q(v,"showModal"),R=q(v,"playerData"),V=q(v,"name"),g=T(()=>!(C.value&&c.fullPath.includes("room"))),$=async()=>{try{const t=M(i,"players"),e=await d(t),a=[];e.forEach(n=>{const o=n.data();if(o.remain){const s={label:o.name,value:o.character};a.push(s)}}),y.value=a,console.log(y.value)}catch{}},x=async t=>{const e=M(i,"players");let a=P(e,_("character","==",t)),o=(await d(a)).docs.map(s=>b(s.ref,{remain:0}));await Promise.all(o)},S=async t=>{const e=M(i,"players");let a=P(e,_("character","==",t)),n=await d(a);const o=n.docs.map(s=>b(s.ref,{myTurn:1}));if(await Promise.all(o),g.value){a=P(e,_("name","==",k.value)),n=await d(a);const s=n.docs.map(r=>b(r.ref,{myTurn:0}));await Promise.all(s)}},z=async()=>{l.value.length===0?I.warning("請選擇玩家"):g.value?(h.value=!0,await x(l.value),await S(l.value),R.value.attacked>0&&K(i,"players","name",R.value.name,"attacked",-1),m.value=!1,h.value=!1):(await x(l.value),await S(l.value),N.push({path:`${O}/game/${w.value}`,query:{host:C.value?1:0,player:String(V.value)}}))};return G(()=>m.value,t=>{t===!0&&($(),l.value=null)}),(t,e)=>{const a=p("n-select"),n=p("n-button"),o=p("n-card"),s=p("n-modal");return H(),L(s,{show:m.value,"onUpdate:show":e[2]||(e[2]=r=>m.value=r),"mask-closable":!!g.value},{default:f(()=>[D(o,{style:{width:"400px"},title:"選擇下一位玩家",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:f(()=>[D(n,{loading:h.value,size:"large",type:"primary",onClick:e[1]||(e[1]=r=>z())},{default:f(()=>[j("確認")]),_:1},8,["loading"])]),default:f(()=>[D(a,{value:l.value,"onUpdate:value":e[0]||(e[0]=r=>l.value=r),options:y.value},null,8,["value","options"])]),_:1})]),_:1},8,["show","mask-closable"])}}});export{Y as _};
